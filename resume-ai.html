<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jmod AI Â· Resume Intelligence</title>

  <link rel="icon" type="image/png" href="/assets/Signature_WhiteTP.png"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap">

  <style>
    :root{
      --bg-dark:#121212;
      --text-dark:#ffffff;
      --accent-dark:#00ffee;

      --bg-light:#ffffff;
      --text-light:#121212;
      --accent-light:#0000ff;

      --panel-dark: rgba(12,12,12,0.75);
      --panel-light: rgba(255,255,255,0.92);

      --border-dark: rgba(255,255,255,0.12);
      --border-light: rgba(0,0,0,0.12);

      --input-dark: rgba(255,255,255,0.06);
      --input-light: rgba(0,0,0,0.04);
    }

    html[data-theme='dark']{
      background:var(--bg-dark);
      color:var(--text-dark);
      --accent:var(--accent-dark);
      --panel:var(--panel-dark);
      --border:var(--border-dark);
      --input-bg:var(--input-dark);
    }

    html[data-theme='light']{
      background:var(--bg-light);
      color:var(--text-light);
      --accent:var(--accent-light);
      --panel:var(--panel-light);
      --border:var(--border-light);
      --input-bg:var(--input-light);
    }

    body{
      font-family:'Inter',system-ui;
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* =========================
       HEADER + QUICK LINKS
       ========================= */
    header{
      position:sticky;
      top:0;
      z-index:5;
      border-bottom:1px solid var(--border);
      background:linear-gradient(to right,#00ffee,#71fff5,#ffffff);
      color:#000;
    }
    html[data-theme='light'] header{
      background:linear-gradient(to right,#0000ff,#5656fc);
      color:#fff;
    }

    .header-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:0.75rem 1.25rem;
    }

    .title{
      display:flex;
      align-items:center;
      gap:0.75rem;
    }
    .title img{width:32px;border-radius:6px}
    .title strong{font-size:1rem}

    .theme-bulb{
      width:40px;height:40px;
      border-radius:50%;
      border:2px solid currentColor;
      background:transparent;
      cursor:pointer;
      font-size:1rem;
    }

    .quick-links{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:0.6rem;
      padding:0.5rem 0.75rem 0.75rem;
      font-size:0.85rem;
    }

    .quick-links a{
      display:inline-flex;
      align-items:center;
      gap:0.35rem;
      font-weight:700;
      text-decoration:none;
      color:inherit;
      padding:0.35rem 0.55rem;
      border-radius:6px;
      white-space:nowrap;
    }
    .quick-links a:hover{background:rgba(0,0,0,0.1)}

    /* =========================
       CHAT LAYOUT (IM STYLE)
       ========================= */
    main{
      flex:1;
      display:flex;
      flex-direction:column;
      max-width:900px;
      width:100%;
      margin:0 auto;
    }

    .chat-thread{
      flex:1;
      overflow-y:auto;
      padding:1.25rem;
    }

    .msg{
      max-width:80%;
      padding:0.6rem 0.75rem;
      border-radius:12px;
      border:1px solid var(--border);
      margin-bottom:0.65rem;
      white-space:pre-wrap;
      line-height:1.4;
    }
    .msg.user{align-self:flex-end}
    .msg.bot{align-self:flex-start}

    .chat-input{
      border-top:1px solid var(--border);
      padding:0.75rem;
      background:var(--panel);
      display:flex;
      gap:0.5rem;
    }

    textarea,input,button{
      font-family:inherit;
      border-radius:10px;
      border:1px solid var(--border);
      background:var(--input-bg);
      color:inherit;
      padding:0.6rem;
      font-size:0.9rem;
    }

    textarea{flex:1;min-height:48px;resize:none}
    button.primary{
      border:2px solid var(--accent);
      background:transparent;
      color:var(--accent);
      font-weight:900;
      cursor:pointer;
      padding:0.6rem 0.9rem;
    }
    button.primary:disabled{opacity:0.5}

    .status{
      font-size:0.75rem;
      opacity:0.75;
      margin-top:0.25rem;
    }

    footer{
      text-align:center;
      font-size:0.85rem;
      padding:1rem 0;
      opacity:0.75;
    }
  </style>
</head>

<body>

<header id="contactHeader">
  <div class="header-top">
    <div class="title">
      <img src="/assets/Signature_WhiteTP.png" id="headerLogo" alt="JM Logo">
      <strong>Jmod AI Â· Resume Intelligence</strong>
    </div>
    <button class="theme-bulb" id="themeBulb" type="button" aria-label="Toggle theme" title="Toggle theme">ğŸ’¡</button>
  </div>

  <!-- QUICK LINKS STRIP -->
  <div class="quick-links" aria-label="Quick links">
    <a href="https://www.linkedin.com/in/jordanmoddes/" target="_blank" rel="noopener">ğŸ”— LinkedIn</a>
    <a href="https://calendly.com/jmodwork" target="_blank" rel="noopener">ğŸ“… Schedule Interview</a>
    <a href="/Resume-Jordan-Moddes.pdf" target="_blank" rel="noopener">ğŸ“„ Resume</a>
    <a href="tel:2627050853">ğŸ“ Call</a>
    <a href="sms:2627050853">ğŸ’¬ Text</a>
    <a href="/vCard.vcf">ğŸ’¾ Save Contact</a>
  </div>
</header>

<main>
  <div class="chat-thread" id="thread" aria-label="Conversation"></div>

  <div class="chat-input" aria-label="Message input">
    <textarea id="question" placeholder="Ask a direct questionâ€¦" aria-label="Message"></textarea>
    <button class="primary" id="sendBtn" type="button">Send</button>
    <button id="resetChatBtn" type="button" aria-label="Reset conversation" title="Reset conversation">Reset chat</button>
  </div>

  <div class="status" id="status">Tip: To connect live, use â€œSchedule Interviewâ€ or â€œCallâ€ above.</div>
</main>

<footer>
  âœ¦ Crafted by Jordan Moddes Â· AI-Partnership âœ¦
</footer>

<script>
(() => {
  const API = "https://resume-ai-backend-sx60.onrender.com/ask";

  // ===== per-visitor chat isolation =====
  const VISITOR_KEY = "jmod_visitor_id_v1";
  function getVisitorId(){
    let id = localStorage.getItem(VISITOR_KEY);
    if (!id){
      id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : ("v_" + Math.random().toString(16).slice(2) + Date.now().toString(16));
      localStorage.setItem(VISITOR_KEY, id);
    }
    return id;
  }
  const VISITOR_ID = getVisitorId();
  const STORAGE_KEY = `jmod_ai_thread_v1::${VISITOR_ID}`;
  const THEME_KEY = "theme";

  const $ = (id) => document.getElementById(id);
  let threadState = [];

  function loadThread(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const parsed = raw ? JSON.parse(raw) : [];
      return Array.isArray(parsed) ? parsed : [];
    }catch{
      return [];
    }
  }

  function saveThread(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(threadState));
    }catch{}
  }

  function render(){
    const t = $("thread");
    if (!t) return;
    t.innerHTML = "";
    for (const m of threadState){
      if (!m) continue;
      const d = document.createElement("div");
      d.className = "msg " + (m.kind || "bot");
      d.textContent = String(m.text || "");
      t.appendChild(d);
    }
    t.scrollTop = t.scrollHeight;
  }

  function addMsg(kind, text){
    threadState.push({ kind, text: String(text || ""), ts: Date.now() });
    saveThread();
    render();
  }

  async function send(){
    const qEl = $("question");
    const q = (qEl && qEl.value ? qEl.value : "").trim();
    if (!q) return;

    if (qEl) qEl.value = "";
    addMsg("user", q);

    const status = $("status");
    if (status) status.textContent = "Thinkingâ€¦";

    const sendBtn = $("sendBtn");
    if (sendBtn) sendBtn.disabled = true;

    try{
      const res = await fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: q })
      });

      let data = null;
      try { data = await res.json(); } catch { data = null; }

      const answer = (data && data.answer) ? data.answer : (res && !res.ok ? "Server error. Try again." : "No response.");
      addMsg("bot", answer);

      if (status) status.textContent = "Want to talk live? Schedule an interview or call above.";
    }catch{
      addMsg("bot", "Network error. Try again.");
      if (status) status.textContent = "Error.";
    }finally{
      if (sendBtn) sendBtn.disabled = false;
    }
  }

  // theme
  function setTheme(t){
    const theme = (t === "light" || t === "dark") ? t : "dark";
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);

    const src = theme === "dark" ? "/assets/Signature_WhiteTP.png" : "/assets/Signature_BlackTP.png";
    const logo = $("headerLogo");
    if (logo) logo.src = src;

    const icon = document.querySelector('link[rel="icon"]');
    if (icon) icon.href = src;
  }

  // bind UI
  $("sendBtn")?.addEventListener("click", send);
  $("question")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); }
  });

  $("themeBulb")?.addEventListener("click", () => {
    const cur = document.documentElement.getAttribute("data-theme") || "dark";
    setTheme(cur === "dark" ? "light" : "dark");
  });

  // reset convo (this visitor only)
  $("resetChatBtn")?.addEventListener("click", () => {
    localStorage.removeItem(STORAGE_KEY);
    threadState = [];
    render();
    const status = $("status");
    if (status) status.textContent = "Reset. Ready.";
  });

  // init
  setTheme(localStorage.getItem(THEME_KEY) || "dark");
  threadState = loadThread();
  render();
})();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JMOD's Dashboard</title>
  <meta name="color-scheme" content="dark light" />

  <!-- ================================
       CSS (theme + components)
  ================================== -->
  <style>
    :root{--bg:#0b0c10;--card:#13151b;--ink:#e8ebf4;--muted:#a2a8b6;--border:#222631;--accent:#4da3ff;--good:#17e5a1;--bad:#ff7b7b}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{margin:0;background:linear-gradient(180deg,#0b0c10,#0e1218);color:var(--ink);font:14px/1.45 system-ui,Segoe UI,Inter,Arial,sans-serif}
    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:0 14px 48px}
    .section{scroll-margin-top:72px}

    /* Navbar */
    .nav{position:sticky;top:0;z-index:1000;background:#0d0f14cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .navin{max-width:1200px;margin:0 auto;display:flex;gap:18px;align-items:center;justify-content:center;padding:12px}
    .nav a{color:#f1f3f7;text-decoration:none;font-weight:600}
    .nav a:hover{opacity:.85}

    /* Ticker */
    .ticker{white-space:nowrap;overflow:hidden;border-bottom:1px solid var(--border);background:#0e1218}
    .ticker-inner{display:inline-block;padding-block:8px;animation:scroll 200s linear infinite}
    .ticker:hover .ticker-inner{animation-play-state:paused}
    .tick-item{display:inline-block;margin-right:28px;color:#cfe0ff}
    @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

    /* Cards / layout */
    h1{font-size:22px;margin:16px 0}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .card .hd{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .card .bd{padding:14px}
    .pill{font-size:12px;background:#0f1420;border:1px solid var(--border);color:#a9c8ff;padding:5px 10px;border-radius:999px}
    .muted{color:var(--muted)}
    .mini{font-size:12px;color:#cbd5e1}
    iframe{width:100%;height:360px;border:0;border-radius:0 0 16px 16px}

    /* Weather tiles + hourly chips */
    .symbols{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px}
    .sym{border:1px solid var(--border);border-radius:12px;padding:10px}
    .sym .top{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .sym .price{font-size:20px;font-weight:800;margin-top:4px}
    .hrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .hchip{display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid var(--border);background:#0f1218;border-radius:10px;padding:6px 8px;min-width:52px}
    .hchip .ico{font-size:18px;line-height:1}
    .hchip .t{font-weight:700;margin-top:2px}
    .chg.up{color:var(--good)} .chg.down{color:var(--bad)}

    /* VOTD styling (glow-up) */
    .votd {
      position: relative;
      border: 1px solid var(--border);
      border-radius: 16px;
      background:
        linear-gradient(180deg, rgba(77,163,255,.08), rgba(23,229,161,.06)) padding-box,
        linear-gradient(120deg, rgba(77,163,255,.5), rgba(23,229,161,.4)) border-box;
      padding: 18px 18px 14px 18px;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      overflow: hidden;
      animation: softFadeUp .4s ease-out both;
    }
    .votd .q{font-size:18px;line-height:1.6;font-style:italic;letter-spacing:.2px}
    .votd .q::before,.votd .q::after{content:"‚Äú";font-size:32px;line-height:0;margin-right:6px;opacity:.45}
    .votd .q::after{content:"‚Äù";margin-left:6px;margin-right:0}
    .votd .ref{margin-top:10px;text-align:right;color:var(--muted);font-weight:600}
    @keyframes softFadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

    /* Notes */
    textarea{width:100%;min-height:120px;border:1px solid var(--border);background:#0f1218;color:var(--ink);border-radius:12px;padding:10px}

    /* Footer / back to top */
    .btm{display:flex;justify-content:center;margin:28px 0}
    .btn-top{background:#0f1420;border:1px solid var(--border);color:#a9c8ff;padding:8px 14px;border-radius:999px;text-decoration:none;font-weight:600}
    .btn-top:hover{opacity:.9}
    .footer{color:#9aa3b6;text-align:center;padding-bottom:24px}
  </style>
</head>
<body>

  <!-- NAV -->
  <div class="nav">
    <div class="navin">
      <a href="/">üè† Resume</a>
      <a href="#events">Local Events</a>
      <a href="#traffic">Traffic</a>
      <a href="#stocks">Stocks</a>
      <a href="#notes">Scratchpad</a>
    </div>
  </div>

  <!-- TICKER -->
  <div class="ticker"><div id="ticker" class="ticker-inner"></div></div>

  <!-- PAGE CONTENT -->
  <div class="wrap">

    <!-- WELCOME -->
    <div class="card section" id="welcome">
      <div class="hd">
        <div>Welcome</div>
        <span id="todayPill" class="pill"></span>
      </div>
      <div class="bd">
        <div style="font-weight:700;margin-bottom:8px;font-size:18px">Welcome to my private dashboard.</div>
        <div class="muted">I‚Äôm bored and tinkering‚Äîlearning by building. Feel free to poke around and enjoy what‚Äôs on display.</div>
      </div>
    </div>

    <!-- WEATHER -->
    <div class="card section" id="weather" style="margin-top:16px">
      <div class="hd"><div>Weather</div></div>
      <div class="bd">
        <div id="weatherList" class="symbols"></div>
      </div>
    </div>

    <!-- SUNRISE / SUNSET + VERSE + EVENTS -->
    <div class="grid grid-2" style="margin-top:16px">
      <div class="card" id="sun">
        <div class="hd"><div>Sunrise ‚Ä¢ Sunset</div><span id="sunDate" class="pill"></span></div>
        <div class="bd"><div id="sunOut" class="muted">Loading‚Ä¶</div></div>
      </div>

      <div class="card" id="votdCard">
        <div class="hd"><div>Verse of the Day</div></div>
        <div class="bd" id="votd"><div class="muted">Loading‚Ä¶</div></div>
      </div>
    </div>

    <div class="card section" id="events" style="margin-top:16px">
      <div class="hd"><div>Local Events</div><span class="pill">next 7‚Äì14 days</span></div>
      <div class="bd"><div id="eventsList" class="symbols"></div></div>
    </div>

    <!-- TRAFFIC -->
    <h1 class="section" id="traffic" style="margin-top:16px">Traffic</h1>
    <div class="grid grid-2">
      <div class="card">
        <div class="hd"><div>To Work</div></div>
        <iframe id="map1" title="route1"></iframe>
      </div>
      <div class="card">
        <div class="hd"><div>To Home</div></div>
        <iframe id="map2" title="route2"></iframe>
      </div>
    </div>

    <!-- STOCKS -->
    <div class="card section" id="stocks" style="margin-top:16px">
      <div class="hd"><div>Stocks</div><span class="pill">auto refresh</span></div>
      <div class="bd"><div id="stocksList" class="symbols"></div></div>
    </div>

    <!-- SCRATCHPAD -->
    <div class="card section" id="notes" style="margin-top:16px">
      <div class="hd"><div>Scratchpad</div><button id="clearNotes" class="pill">Clear</button></div>
      <div class="bd"><textarea id="notesBox" placeholder="Jot quick notes‚Ä¶"></textarea></div>
    </div>

    <div class="btm"><a href="#top" class="btn-top">Top</a></div>
    <div class="footer">‚ú¶ Crafted by Jordan Moddes ¬∑ Built with GPT-5 Thinking ‚ú¶</div>
  </div>

  <!-- ================================
       JS (config + features)
  ================================== -->
  <script>
  /* ---------- CONFIG ---------- */
  const WORKER_BASE = "https://jmoddashboard.jmodwork.workers.dev";   // your worker
  const GOOGLE_MAPS_API_KEY = "AIzaSyCePcq9W-S5yxscXJ2N2MBMoGtpeTAXZnQ";

  const A = "2670 S AW Grimes Blvd, Round Rock, TX 78664";
  const B = "411 W Main St, Round Rock, TX 78664";

  const WEATHER_ZIPS = ["78664","53158","60030","23314","44115"]; // order you requested
  const STOCKS = ["BRK.A","BRK.B","AAPL","NVDA","AXP","DAL","HHH","ABNB","SNAP","MOS","RIVN","KO","FWONK","TSLA","AMZN","GNW"];

  // locked-in coords (fast, reliable)
  const ZIP_COORDS = {
    "78664": { lat: 30.5083, lon: -97.6789, name: "Round Rock, TX" },
    "53158": { lat: 42.5531, lon: -87.9501, name: "Pleasant Prairie, WI" },
    "60030": { lat: 42.3445, lon: -88.0417, name: "Grayslake, IL" },
    "23314": { lat: 36.9410, lon: -76.5610, name: "Carrollton, VA" },
    "44115": { lat: 41.4993, lon: -81.6944, name: "Cleveland, OH" }
  };

  /* ---------- helpers ---------- */
  const $ = s => document.querySelector(s);
  const escapeHtml = s => String(s).replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
  const enc = s => encodeURIComponent(s).replace(/%20/g,'+');
  const toF = c => (c*9/5)+32;
  const iconFor = code => ({0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üå¶Ô∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",71:"‚ùÑÔ∏è",73:"‚ùÑÔ∏è",75:"‚ùÑÔ∏è",80:"üå¶Ô∏è",81:"üå¶Ô∏è",82:"üåßÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"}[code] ?? "üå°Ô∏è");

  /* ---------- top date pill ---------- */
  function setTodayPill(){
    const d = new Date();
    const txt = `${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}/${d.getFullYear()}`;
    $("#todayPill").textContent = txt;
  }

  /* ---------- ticker ---------- */
  async function loadTicker(){
    const el = $("#ticker");
    try{
      const r = await fetch(`${WORKER_BASE}/ticker?sources=nfl,f1,general`);
      const items = await r.json();
      const twice = items.concat(items);
      el.innerHTML = twice.map(x=>`<span class="tick-item">‚Ä¢ ${escapeHtml(x.title)}</span>`).join("");
    }catch{
      el.innerHTML = `<span class="tick-item">Ticker unavailable</span>`;
    }
  }

  /* ---------- traffic ---------- */
  const gEmbed = (o,d)=>`https://www.google.com/maps/embed/v1/directions?key=${GOOGLE_MAPS_API_KEY}&origin=${enc(o)}&destination=${enc(d)}&mode=driving`;
  function updateTraffic(){ $("#map1").src=gEmbed(A,B); $("#map2").src=gEmbed(B,A); }

  /* ---------- weather (via worker wx, fallback direct) ---------- */
  async function fetchWeather(lat, lon){
    try{
      const r = await fetch(`${WORKER_BASE}/wx?lat=${lat}&lon=${lon}`);
      if (r.ok) return await r.json();
    }catch{}
    const url = new URL("https://api.open-meteo.com/v1/forecast");
    url.search = new URLSearchParams({
      latitude: lat, longitude: lon, timezone: "auto", wind_speed_unit: "mph",
      current: "temperature_2m,apparent_temperature,wind_speed_10m,weather_code,time",
      daily: "temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code",
      hourly: "temperature_2m,weather_code"
    }).toString();
    const r2 = await fetch(url.toString());
    return r2.json();
  }

  async function loadWeather(){
    const host = $("#weatherList"); host.innerHTML="";
    const zips = [...new Set(WEATHER_ZIPS)];  // de-dupe just in case
    for (const zip of zips){
      try{
        const geo = ZIP_COORDS[zip];
        const data = await fetchWeather(geo.lat, geo.lon);
        const cur = data.current;
        // next 5 hours
        const times = data.hourly.time.map(t => new Date(t));
        const tempsC = data.hourly.temperature_2m;
        const codes = data.hourly.weather_code;
        let idx = times.findIndex(t => t >= new Date());
        if (idx < 0) idx = 0;
        const hrs = [];
        for (let i=0;i<5 && idx+i<times.length;i++){
          const dt = times[idx+i];
          hrs.push({ hour: dt.getHours().toString().padStart(2,"0"), tempC: tempsC[idx+i], code: codes[idx+i] });
        }
        const div = document.createElement("div"); div.className="sym";
        div.innerHTML = `
          <div class="top">
            <div><strong>${geo.name}</strong></div>
            <div class="mini">${Math.round(cur.wind_speed_10m)} mph wind</div>
          </div>
          <div class="price">${Math.round(toF(cur.temperature_2m))}¬∞F / ${Math.round(cur.temperature_2m)}¬∞C</div>
          <div class="mini muted">Feels ${Math.round(toF(cur.apparent_temperature))}¬∞F ¬∑ Today ${Math.round(toF(data.daily.temperature_2m_min[0]))}¬∞F ‚Äì ${Math.round(toF(data.daily.temperature_2m_max[0]))}¬∞F</div>
          <div class="hrow">
            ${hrs.map(h=>`
              <div class="hchip">
                <div class="ico">${iconFor(h.code)}</div>
                <div class="t mini">${Math.round(toF(h.tempC))}¬∞F</div>
                <div class="mini muted">${h.hour}:00</div>
              </div>`).join("")}
          </div>`;
        host.appendChild(div);
      }catch(e){
        const div=document.createElement("div");div.className="sym";
        div.innerHTML=`<div class="top"><div><strong>${zip}</strong></div></div><div class="mini muted">Weather unavailable</div>`;
        host.appendChild(div);
      }
    }
  }

  /* ---------- sunrise/sunset ---------- */
  async function loadSun(){
    const d = new Date();
    $("#sunDate").textContent = `${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}/${d.getFullYear()}`;
    try{
      // use Round Rock for the main ‚Äúlocal sun‚Äù
      const {lat,lon} = ZIP_COORDS["78664"];
      const r = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`);
      const j = await r.json();
      const sr = new Date(j.results.sunrise);
      const ss = new Date(j.results.sunset);
      const tf = t => t.toLocaleTimeString([], {hour:"numeric",minute:"2-digit"});
      $("#sunOut").textContent = `Sunrise ${tf(sr)} ‚Ä¢ Sunset ${tf(ss)}`;
    }catch{
      $("#sunOut").textContent = "Sunrise/Sunset unavailable";
    }
  }

  /* ---------- verse of the day ---------- */
  async function loadVOTD(){
    const host = $("#votd");
    const set = (text, ref) => {
      host.innerHTML = `
        <div class="votd">
          <div class="q">${escapeHtml(text)}</div>
          <div class="ref">‚Äî ${escapeHtml(ref)}</div>
        </div>`;
    };
    try{
      const r = await fetch("https://beta.ourmanna.com/api/v1/get/?format=json");
      const j = await r.json();
      const details = j?.verse?.details || j?.verse?.verse?.details || j?.verse?.details || j?.details;
      const text = details?.text || details?.verse || j?.verse?.text;
      const ref  = details?.reference || details?.display_ref || j?.verse?.reference;
      if (text && ref){
        set(text, ref);
        localStorage.setItem("votd_cache", JSON.stringify({text,ref,ts:Date.now()}));
        return;
      }
      throw new Error("unexpected payload");
    }catch{
      const cached = JSON.parse(localStorage.getItem("votd_cache")||"null");
      if (cached?.text && cached?.ref) set(cached.text, cached.ref);
      else set("Verse unavailable right now. Check back soon.", "-");
    }
  }

  /* ---------- local events (via worker /events) ---------- */
  async function loadEvents(){
    const host=$("#eventsList"); host.innerHTML="";
    try{
      // Use Round Rock as the ‚Äúlocal‚Äù center; Worker handles TM_KEY + caching
      const {lat,lon} = ZIP_COORDS["78664"];
      const r = await fetch(`${WORKER_BASE}/events?lat=${lat}&lon=${lon}`);
      if (!r.ok) throw 0;
      const items = await r.json(); // [{name,when,venue,url}]
      if (!items.length){ host.innerHTML = `<div class="mini muted">No events found.</div>`; return; }
      for (const e of items.slice(0,12)){
        const card=document.createElement("div"); card.className="sym";
        card.innerHTML = `
          <div class="top"><strong>${escapeHtml(e.name)}</strong></div>
          <div class="mini">${escapeHtml(e.when||"")}${e.venue?` ¬∑ ${escapeHtml(e.venue)}`:""}</div>
          <div style="margin-top:6px"><a class="pill" href="${e.url}" target="_blank" rel="noopener">Open details ‚Üó</a></div>`;
        host.appendChild(card);
      }
    }catch{
      host.innerHTML = `<div class="mini muted">Add TM_KEY to your Worker to enable local events.</div>`;
    }
  }

  /* ---------- stocks (via worker quotes) ---------- */
  async function loadStocks(){
    const host = $("#stocksList"); host.innerHTML = "";
    try{
      const url = `${WORKER_BASE}/quotes?symbols=${encodeURIComponent(STOCKS.join(','))}`;
      const r = await fetch(url);
      const rows = await r.json();
      if (!Array.isArray(rows) || !rows.length){
        host.innerHTML = `<div class='mini muted'>No quote data returned.</div>`;
        return;
      }
      rows.forEach(q=>{
        const chg = (q.changePercent == null) ? null : Number(q.changePercent);
        const div = document.createElement("div"); div.className = "sym";
        div.innerHTML = `
          <div class="top">
            <div><strong>${q.symbol}</strong> <span class="mini muted">${escapeHtml(q.name||"")}</span></div>
            <div class="mini ${chg==null ? "muted" : ("chg " + (chg>=0?"up":"down"))}">
              ${chg==null ? "‚Äî" : `${chg>=0?"+":""}${chg.toFixed(2)}%`}
            </div>
          </div>
          <div class="price">$${Number(q.price||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}</div>`;
        host.appendChild(div);
      });
    }catch{
      host.innerHTML = `<div class='mini muted'>Quotes unavailable.</div>`;
    }
  }

  /* ---------- notes ---------- */
  const notesEl=$("#notesBox");
  notesEl.value=localStorage.getItem("dashboard-notes")||"";
  notesEl.addEventListener("input",()=>localStorage.setItem("dashboard-notes",notesEl.value));
  $("#clearNotes").onclick=()=>{notesEl.value="";localStorage.removeItem("dashboard-notes");};

  /* ---------- init ---------- */
  setTodayPill();
  loadTicker();
  updateTraffic(); setInterval(updateTraffic, 120000);
  loadWeather();   // no interval ‚Äì hourly data
  loadSun();       // daily
  loadVOTD(); setInterval(loadVOTD, 30*60*1000);   // refresh every 30 min
  loadEvents();    // relies on Worker TM_KEY
  loadStocks(); setInterval(loadStocks, 60000);
  </script>
</body>
</html>

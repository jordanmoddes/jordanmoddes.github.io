<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JMOD's Dashboard</title>
  <meta name="color-scheme" content="dark light" />

  <!-- ================================
       CSS: THEME, LAYOUT, COMPONENTS
       ================================= -->
  <style>
    :root{--bg:#0b0c10;--card:#13151b;--ink:#e8ebf4;--muted:#a2a8b6;--border:#222631;--accent:#4da3ff;--good:#17e5a1;--bad:#ff7b7b}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{margin:0;background:linear-gradient(180deg,#0b0c10,#0e1218);color:var(--ink);font:14px/1.45 system-ui,Segoe UI,Inter,Arial,sans-serif}
    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:0 14px 48px}

    /* Navbar */
    .nav{position:sticky;top:0;z-index:1000;background:#0d0f14cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .navin{max-width:1200px;margin:0 auto;display:flex;gap:18px;align-items:center;justify-content:center;padding:12px}
    .nav a{color:#f1f3f7;text-decoration:none;font-weight:600}
    .nav a:hover{opacity:.85}

    /* Ticker */
    .ticker{white-space:nowrap;overflow:hidden;border-bottom:1px solid var(--border);background:#0e1218}
    .ticker-inner{display:inline-block;padding-block:8px;animation:scroll 160s linear infinite} /* slowed to 160s */
    .ticker:hover .ticker-inner{animation-play-state:paused}
    .tick-item{display:inline-block;margin-right:28px;color:#cfe0ff}
    @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

    /* Layout */
    h1{font-size:22px;margin:16px 0}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .card .hd{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .card .bd{padding:14px}
    .pill{font-size:12px;background:#0f1420;border:1px solid #1f2a43;color:#a9c8ff;padding:5px 10px;border-radius:999px}
    iframe{width:100%;height:360px;border:0;border-radius:0 0 16px 16px}
    .muted{color:var(--muted)}
    .mini{font-size:12px;color:#cbd5e1}
    .section{scroll-margin-top:72px}

    /* Weather hourly chips */
    .hrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .hchip{display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid var(--border);background:#0f1218;border-radius:10px;padding:6px 8px;min-width:52px}
    .hchip .ico{font-size:18px;line-height:1}
    .hchip .t{font-weight:700;margin-top:2px}

    /* Stock/Crypto grid */
    .symbols{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px}
    .sym{border:1px solid var(--border);border-radius:12px;padding:10px}
    .sym .top{display:flex;justify-content:space-between}
    .sym .price{font-size:20px;font-weight:800;margin-top:4px}
    .chg.up{color:var(--good)} .chg.down{color:var(--bad)}

    /* Notes */
    textarea{width:100%;min-height:120px;border:1px solid var(--border);background:#0f1218;color:var(--ink);border-radius:12px;padding:10px}

    /* Bottom ‚ÄúTop‚Äù button + footer */
    .btm{display:flex;justify-content:center;margin:28px 0}
    .btn-top{background:#0f1420;border:1px solid var(--border);color:#a9c8ff;padding:8px 14px;border-radius:999px;text-decoration:none;font-weight:600}
    .btn-top:hover{opacity:.9}
    .footer{color:#9aa3b6;text-align:center;padding-bottom:24px}
  </style>
</head>
<body>

  <!-- ================================
       HTML: NAV + TICKER
       ================================= -->
  <div class="nav">
    <div class="navin">
      <a href="/">üè† Resume</a>
      <a href="#traffic">Traffic</a>
      <a href="#weather">Weather</a>
      <a href="#stocks">Stocks</a>
      <a href="#notes">Scratchpad</a>
    </div>
  </div>

  <div class="ticker"><div id="ticker" class="ticker-inner"></div></div>

  <!-- ================================
       HTML: PAGE CONTENT
       ================================= -->
  <div class="wrap">
    <h1 class="section" id="traffic">Personal Dashboard</h1>

    <!-- TRAFFIC -->
    <div class="grid">
      <div class="card">
        <div class="hd"><div>Traffic To Work</div></div>
        <iframe id="map1" title="route1"></iframe>
      </div>

      <div class="card">
        <div class="hd"><div>Traffic To Home</div></div>
        <iframe id="map2" title="route2"></iframe>
      </div>
    </div>

    <!-- WEATHER -->
    <div class="card section" id="weather" style="margin-top:16px">
      <div class="hd"><div>Weather</div></div>
      <div class="bd"><div id="weatherList"></div></div>
    </div>

    <!-- STOCKS -->
    <div class="card section" id="stocks" style="margin-top:16px">
      <div class="hd"><div>Stocks</div><span class="pill">auto refresh</span></div>
      <div class="bd"><div id="stocksList" class="symbols"></div></div>
    </div>

    <!-- CRYPTO -->
    <div class="card section" id="crypto" style="margin-top:16px">
      <div class="hd"><div>Crypto</div><span class="pill">Coingecko ¬∑ no key</span></div>
      <div class="bd"><div id="cryptoList" class="symbols"></div></div>
    </div>

    <!-- NOTES -->
    <div class="card section" id="notes" style="margin-top:16px">
      <div class="hd"><div>Scratchpad</div><button id="clearNotes" class="pill">Clear</button></div>
      <div class="bd"><textarea id="notesBox" placeholder="Jot quick notes‚Ä¶"></textarea></div>
    </div>

    <!-- Back to top + footer -->
    <div class="btm"><a href="#top" class="btn-top">Top</a></div>
    <div class="footer">‚ú¶ Crafted by Jordan Moddes ¬∑ Built with GPT-5 Thinking ‚ú¶</div>
  </div>

  <!-- ================================
       JS: CONFIG + HELPERS + FEATURES
       ================================= -->
<script>
  const WORKER_BASE = "https://jmoddashboard.jmodwork.workers.dev";
  const GOOGLE_MAPS_API_KEY = "AIzaSyCePcq9W-S5yxscXJ2N2MBMoGtpeTAXZnQ";

  const A = "2670 S AW Grimes Blvd, Round Rock, TX 78664";
  const B = "411 W Main St, Round Rock, TX 78664";

  const WEATHER_ZIPS = ["78664","53158","60030","44115"];
  const STOCKS = ["BRK.A","BRK.B","AAPL","NVDA","AXP","DAL","HHH","ABNB","SNAP","MOS","RIVN","KO","FWONK","TSLA","AMZN","GNW"];
  const CRYPTO = ["bitcoin","ethereum","dogecoin"];

  const $ = sel => document.querySelector(sel);
  const escapeHtml = s => String(s).replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
  const enc = s => encodeURIComponent(s).replace(/%20/g,'+');
  const toF = c => (c * 9/5) + 32;
  const iconFor = code => ({0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üå¶Ô∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",71:"‚ùÑÔ∏è",73:"‚ùÑÔ∏è",75:"‚ùÑÔ∏è",80:"üå¶Ô∏è",81:"üå¶Ô∏è",82:"üåßÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"}[code] ?? "üå°Ô∏è");

  // ---------- TICKER ----------
  async function loadTicker(){
    const el = $("#ticker");
    try{
      const r = await fetch(`${WORKER_BASE}/ticker?sources=nfl,f1,general`);
      const items = await r.json();
      const twice = items.concat(items);
      el.innerHTML = twice.map(x=>`<span class="tick-item">‚Ä¢ ${escapeHtml(x.title)}</span>`).join("");
    }catch{ el.innerHTML = `<span class="tick-item">Ticker unavailable</span>`; }
  }

  // ---------- TRAFFIC ----------
  const googleEmbed = (o,d)=>`https://www.google.com/maps/embed/v1/directions?key=${GOOGLE_MAPS_API_KEY}&origin=${enc(o)}&destination=${enc(d)}&mode=driving`;
  function updateTraffic(){ $("#map1").src=googleEmbed(A,B); $("#map2").src=googleEmbed(B,A); }

// ---------- WEATHER: robust ZIP -> (lat, lon, city) ----------
async function geocodeZip(zip){
  // 1) Zippopotam (no key)
  try {
    const r = await fetch(`https://api.zippopotam.us/us/${zip}`);
    if (r.ok) {
      const j = await r.json();
      const p = j.places?.[0];
      if (p) {
        return {
          lat: Number(p.latitude),
          lon: Number(p.longitude),
          name: `${p["place name"]}, ${p["state abbreviation"]}`
        };
      }
    }
  } catch {}

  // 2) Open-Meteo geocoder (hint with USA)
  try {
    const r2 = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(zip + " USA")}&count=1&language=en&format=json`);
    if (r2.ok) {
      const j2 = await r2.json();
      const g = j2.results?.[0];
      if (g) {
        const label = [g.name, g.admin1, g.country_code].filter(Boolean).join(", ");
        return { lat: g.latitude, lon: g.longitude, name: label };
      }
    }
  } catch {}

  // 3) Final safety net ‚Äî known coords for your ZIPs
  const FALLBACK = {
    "78664": { lat: 30.5083, lon: -97.6789, name: "Round Rock, TX" },
    "53158": { lat: 42.5531, lon: -87.9501, name: "Pleasant Prairie, WI" },
    "60030": { lat: 42.3445, lon: -88.0417, name: "Grayslake, IL" },
    "44115": { lat: 41.4993, lon: -81.6944, name: "Cleveland, OH" }
  };
  if (FALLBACK[zip]) return FALLBACK[zip];

  // If truly unknown, throw so the UI shows "Weather unavailable"
  throw new Error("Geocoding failed");
}


  // ---------- STOCKS ----------
  const mapYahoo=s=>s.replace("BRK.A","BRK-A").replace("BRK.B","BRK-B");
  async function loadStocks(){
    const host=$("#stocksList");host.innerHTML="";
    try{
      const r=await fetch(`${WORKER_BASE}/quotes?symbols=${STOCKS.map(mapYahoo).join(',')}`);
      const rows=await r.json();
      rows.forEach(q=>{
        const chg=q.changePercent??0;
        const d=document.createElement("div");d.className="sym";
        d.innerHTML=`<div class="top"><div><strong>${q.symbol}</strong><span class="mini muted">${escapeHtml(q.name||"")}</span></div>
        <div class="mini chg ${chg>=0?"up":"down"}">${chg>=0?"+":""}${chg.toFixed(2)}%</div></div>
        <div class="price">$${Number(q.price||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}</div>`;
        host.appendChild(d);
      });
    }catch(e){host.innerHTML=`<div class='mini muted'>Stock data unavailable</div>`;}
  }

  // ---------- CRYPTO ----------
  const nice=id=>id.charAt(0).toUpperCase()+id.slice(1);
  async function loadCrypto(){
    const host=$("#cryptoList");host.innerHTML="";
    try{
      const url=new URL("https://api.coingecko.com/api/v3/simple/price");
      url.search=new URLSearchParams({ids:CRYPTO.join(","),vs_currencies:"usd",include_24hr_change:"true"}).toString();
      const r=await fetch(url),j=await r.json();
      for(const id of CRYPTO){
        if(!j[id]) continue;
        const chg=Number(j[id].usd_24h_change||0);
        const div=document.createElement("div");div.className="sym";
        div.innerHTML=`<div class="top"><strong>${nice(id)}</strong><div class="mini chg ${chg>=0?"up":"down"}">${chg>=0?"+":""}${chg.toFixed(2)}%</div></div>
        <div class="price">$${Number(j[id].usd||0).toLocaleString()}</div>`;
        host.appendChild(div);
      }
    }catch{host.innerHTML=`<div class='mini muted'>Crypto unavailable</div>`;}
  }

  // ---------- NOTES ----------
  const notesEl=$("#notesBox");
  notesEl.value=localStorage.getItem("dashboard-notes")||"";
  notesEl.addEventListener("input",()=>localStorage.setItem("dashboard-notes",notesEl.value));
  $("#clearNotes").onclick=()=>{notesEl.value="";localStorage.removeItem("dashboard-notes");};

  // ---------- INIT ----------
  loadTicker();
  updateTraffic(); setInterval(updateTraffic,120000);
  loadWeather();
  loadStocks(); setInterval(loadStocks,60000);
  loadCrypto(); setInterval(loadCrypto,120000);
</script>
</body>
</html>

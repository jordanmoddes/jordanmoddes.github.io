<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JMOD‚Äôs Dashboard</title>
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#0b0c10;--card:#13151b;--ink:#e8ebf4;--muted:#a2a8b6;--border:#222631;
      --accent:#4da3ff;--good:#17e5a1;--bad:#ff7b7b
    }
    html,body{height:100%}
    html{scroll-behavior:smooth}
    /* Animated background: subtle gradients + faint grid */
    body{
      margin:0;color:var(--ink);
      background:
        radial-gradient(1200px 800px at 10% -20%, rgba(77,163,255,.10), transparent 60%),
        radial-gradient(900px 700px at 90% 120%, rgba(180,77,255,.08), transparent 60%),
        linear-gradient(180deg,#0b0c10,#0e1218);
      position:relative;
      overflow-x:hidden;
    }
    body::before{
      content:""; position:fixed; inset:-2px;
      background:
        linear-gradient(90deg, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px,
        linear-gradient(0deg,  rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px;
      opacity:.15; pointer-events:none; z-index:0;
      animation:floatBG 40s linear infinite;
    }
    @keyframes floatBG{0%{transform:translateY(0)}50%{transform:translateY(-12px)}100%{transform:translateY(0)}}

    a{color:inherit;text-decoration:none}
    .wrap{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:0 14px 48px}

    /* Nav */
    .nav{position:sticky;top:0;z-index:1000;background:#0d0f14cc;backdrop-filter:blur(8px);/* no border line */
         border-bottom:0}
    .navin{max-width:1200px;margin:0 auto;display:flex;gap:18px;align-items:center;
           justify-content:center;padding:12px}
    .nav a{color:#f1f3f7;font-weight:600}
    .nav a:hover{opacity:.85}

    /* Ticker (no border line) */
    .ticker{white-space:nowrap;overflow:hidden;background:#0e121800;border:0}
    .ticker-inner{display:inline-block;padding-block:8px;animation:scroll 200s linear infinite}
    .ticker:hover .ticker-inner{animation-play-state:paused}
    .tick-item{display:inline-block;margin-right:28px;color:#cfe0ff}
    @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

    /* Cards / layout */
    h1{font-size:22px;margin:16px 0}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;
          box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .card .hd{padding:12px 14px;border-bottom:1px solid var(--border);
              display:flex;justify-content:space-between;align-items:center}
    .card .bd{padding:14px}
    .pill{font-size:12px;background:#0f1420;border:1px solid #1f2a43;color:#a9c8ff;
          padding:5px 10px;border-radius:999px}
    .mini{font-size:12px;color:#cbd5e1}
    .muted{color:var(--muted)}
    .section{scroll-margin-top:72px}
    iframe{width:100%;height:360px;border:0;border-radius:0 0 16px 16px}

    /* Grids & tiles reused for weather/stocks/crypto/events */
    .symbols{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px}
    .sym{border:1px solid var(--border);border-radius:12px;padding:10px}
    .sym .top{display:flex;justify-content:space-between;gap:8px}
    .sym .price{font-size:20px;font-weight:800;margin-top:4px}
    .hrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .hchip{display:flex;flex-direction:column;align-items:center;justify-content:center;
           border:1px solid var(--border);background:#0f1218;border-radius:10px;padding:6px 8px;min-width:52px}
    .hchip .ico{font-size:18px;line-height:1}
    .hchip .t{font-weight:700;margin-top:2px}
    .chg.up{color:var(--good)} .chg.down{color:var(--bad)}

    /* Notes */
    textarea{width:100%;min-height:120px;border:1px solid var(--border);background:#0f1218;
             color:var(--ink);border-radius:12px;padding:10px}

    /* ‚ÄúTop‚Äù + footer */
    .btm{display:flex;justify-content:center;margin:28px 0}
    .btn-top{background:#0f1420;border:1px solid var(--border);color:#a9c8ff;padding:8px 14px;
             border-radius:999px;font-weight:600}
    .btn-top:hover{opacity:.9}
    .footer{color:#9aa3b6;text-align:center;padding-bottom:24px}

    /* VOTD card */
    .votd-card{
      position:relative;border:1px solid var(--border);border-left:4px solid var(--accent);
      background:radial-gradient(1200px 400px at -10% -40%, rgba(77,163,255,.12), transparent 40%),
                 linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.06));
      border-radius:14px;padding:18px 16px 14px;box-shadow:0 10px 30px rgba(0,0,0,.25)
    }
    .votd-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .votd-badge{font-size:12px;font-weight:700;letter-spacing:.04em;color:#cfe0ff;
      background:#0f1420;border:1px solid #1f2a43;border-radius:999px;padding:4px 10px}
    .votd-date{font-size:12px;color:var(--muted)}
    .votd-quote{margin:4px 0 10px;font-size:clamp(18px,2.2vw,22px);line-height:1.5;font-weight:600;color:var(--ink);position:relative}
    .votd-quote::before{content:"‚Äú";position:absolute;left:-14px;top:-6px;font-size:28px;line-height:1;opacity:.25}
    .votd-quote::after{content:"‚Äù";margin-left:4px;opacity:.25}
    .votd-bottom{display:flex;justify-content:flex-end}
    .votd-ref{font-size:13px;color:#a9c8ff;font-weight:700}

    /* Simple table for Pelosi list */
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-top:1px solid var(--border);padding:8px;text-align:left;font-size:12px}
    .table th{color:#cfe0ff}

    /* Conversions (scoped styles) */
    .cv-wrap{display:grid;gap:14px;margin:12px 0}
    .cv-row{grid-template-columns:repeat(4,minmax(160px,1fr))}
    .cv-card{border:1px solid var(--border);border-radius:12px;padding:12px}
    .cv-card h4{margin:0 0 8px;font-size:1rem;font-weight:600}
    .cv-io{display:flex;align-items:center;gap:8px;margin:6px 0}
    .cv-io input{flex:1;padding:6px 8px;border:1px solid rgba(127,127,127,.35);border-radius:8px;background:transparent;color:inherit}
    .cv-out{min-width:5ch;font-variant-numeric:tabular-nums}
    .cv-muted{opacity:.75;font-size:.9em}
    .cv-grid-2{display:grid;grid-template-columns:repeat(2,minmax(160px,1fr));gap:10px}
    .cv-grid-3{display:grid;grid-template-columns:repeat(3,minmax(120px,1fr));gap:8px}
    .cv-split{display:grid;grid-template-columns:repeat(2,minmax(180px,1fr));gap:12px}
    .cv-table{width:100%;border-collapse:collapse;font-variant-numeric:tabular-nums}
    .cv-table td{padding:6px 8px;border-top:1px dashed rgba(127,127,127,.25)}
    .cv-table tr:first-child td{border-top:none}
    .cv-right{text-align:right}
    @media (max-width:900px){
      .cv-row{grid-template-columns:repeat(2,minmax(160px,1fr))}
      .cv-split{grid-template-columns:1fr}
    }
    @media (max-width:520px){
      .cv-row{grid-template-columns:1fr}
      .cv-grid-2{grid-template-columns:1fr}
      .cv-grid-3{grid-template-columns:1fr}
    }

    /* Sunrise/Sunset arc */
    .sunbox{display:flex;flex-direction:column;gap:8px}
    .sun-legend{display:flex;gap:10px;align-items:center}
    .sun-dot{width:10px;height:10px;border-radius:50%}
    .sun-dot.fill{background:#ffd166}
    .sun-dot.hollow{border:2px solid #ffd166;background:transparent}
  </style>
</head>
<body>

  <!-- NAV -->
  <div class="nav">
    <div class="navin">
      <a href="/">üè† Resume</a>
      <a href="#events">Local Events</a>
      <a href="#traffic">Traffic</a>
      <a href="#stocks">Stocks</a>
      <a href="#notes">Scratchpad</a>
      <a href="https://www.jordanmoddes.com/jmodco/">Jmod Co.</a>
    </div>
  </div>

  <!-- SPORTS TICKER -->
  <div class="ticker"><div id="ticker" class="ticker-inner"></div></div>

  <div class="wrap">
    <h1 class="section" id="welcome">Welcome</h1>

    <!-- WELCOME -->
    <div class="card">
      <div class="hd">
        <div>Welcome</div>
        <span id="todayBadge" class="pill"></span>
      </div>
      <div class="bd">
        <div class="mini muted" style="margin-bottom:8px">
          Welcome to my private dashboard. I‚Äôm tinkering, learning, and having fun‚Äîfeel free to explore anything on display.
        </div>
      </div>
    </div>

    <!-- WEATHER -->
    <div class="card section" id="weather" style="margin-top:16px">
      <div class="hd"><div>Weather</div></div>
      <div class="bd"><div id="weatherList" class="symbols"></div></div>
    </div>

    <!-- SUNRISE / SUNSET -->
    <div class="card section" id="sun" style="margin-top:16px">
      <div class="hd"><div>Sunrise ‚Ä¢ Sunset</div><span id="sunDate" class="pill"></span></div>
      <div class="bd">
        <div class="sunbox">
          <div id="sunViz"></div>
          <div class="sun-legend mini">
            <span class="sun-dot fill"></span> <span class="muted">‚óè sun above horizon</span>
            <span style="width:10px"></span>
            <span class="sun-dot hollow"></span> <span class="muted">‚óã night</span>
          </div>
          <div id="sunLine" class="mini"></div>
        </div>
      </div>
    </div>

    <!-- VOTD + EVENTS -->
    <div class="grid cols-2 section" id="events" style="margin-top:16px">
      <div class="card">
        <div class="hd"><div>Verse of the Day</div></div>
        <div class="bd">
          <div class="votd-card">
            <div class="votd-top">
              <span class="votd-badge">Verse of the Day</span>
              <span id="votdDate" class="votd-date"></span>
            </div>
            <blockquote id="votdText" class="votd-quote">Loading‚Ä¶</blockquote>
            <div class="votd-bottom"><span id="votdRef" class="votd-ref"></span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><div>Local Events</div><span class="pill">next 7‚Äì14 days</span></div>
        <div class="bd"><div id="eventsList" class="symbols"></div></div>
      </div>
    </div>

    <!-- TRAFFIC -->
    <h1 class="section" id="traffic">Traffic</h1>
    <div class="grid cols-2">
      <div class="card">
        <div class="hd"><div>To Work</div></div>
        <iframe id="map1" title="route1"></iframe>
      </div>
      <div class="card">
        <div class="hd"><div>To Home</div></div>
        <iframe id="map2" title="route2"></iframe>
      </div>
    </div>

    <!-- STOCKS -->
    <div class="card section" id="stocks" style="margin-top:16px">
      <div class="hd"><div>Stocks</div><span class="pill">auto refresh</span></div>
      <div class="bd"><div id="stocksList" class="symbols"></div></div>
    </div>

    <!-- CRYPTO -->
    <div class="card section" id="crypto" style="margin-top:16px">
      <div class="hd"><div>Crypto</div><button id="cryptoRefresh" class="pill">Refresh</button></div>
      <div class="bd">
        <div id="cryptoList" class="symbols"></div>
        <div id="cryptoStatus" class="mini muted" style="margin-top:6px"></div>
      </div>
    </div>

    <!-- PELOSI TRADES -->
    <div class="card section" id="pelosi" style="margin-top:16px">
      <div class="hd"><div>Nancy Pelosi ‚Äî Disclosed Trades (latest 50)</div></div>
      <div class="bd">
        <div id="pelosiStatus" class="mini muted" style="margin-bottom:6px">Loading‚Ä¶</div>
        <div style="overflow:auto">
          <table class="table" id="pelosiTable">
            <thead>
              <tr><th>Disclosed</th><th>Traded</th><th>Ticker / Asset</th><th>Type</th><th>Amount</th><th>PTR</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- CONVERSIONS -->
    <div class="card section" id="conversions" style="margin-top:16px">
      <div class="hd"><div>Conversions</div></div>
      <div class="bd">
        <!-- Four compact tiles -->
        <div class="cv-wrap cv-row">
          <div class="cv-card">
            <h4>F ‚Üí C</h4>
            <div class="cv-io"><input id="f_in" type="number" step="any" placeholder="¬∞F"><span>¬∞F</span></div>
            <div class="cv-io"><span id="c_out" class="cv-out">‚Äî</span><span class="cv-muted">¬∞C</span></div>
          </div>
          <div class="cv-card">
            <h4>C ‚Üí F</h4>
            <div class="cv-io"><input id="c_in" type="number" step="any" placeholder="¬∞C"><span>¬∞C</span></div>
            <div class="cv-io"><span id="f_out" class="cv-out">‚Äî</span><span class="cv-muted">¬∞F</span></div>
          </div>
          <div class="cv-card">
            <h4>m ‚Üí ft</h4>
            <div class="cv-io"><input id="m_in" type="number" step="any" placeholder="m"><span>m</span></div>
            <div class="cv-io"><span id="ft_out" class="cv-out">‚Äî</span><span class="cv-muted">ft</span></div>
          </div>
          <div class="cv-card">
            <h4>in ‚Üí cm</h4>
            <div class="cv-io"><input id="in_in" type="number" step="any" placeholder="in"><span>in</span></div>
            <div class="cv-io"><span id="cm_out" class="cv-out">‚Äî</span><span class="cv-muted">cm</span></div>
          </div>
        </div>

        <!-- Work Conversions -->
        <h3 style="margin:18px 2px 6px;font-size:1.05rem">Work Conversions</h3>
        <div class="cv-card">
          <div class="cv-split">
            <!-- Inputs -->
            <div>
              <h4 style="margin-bottom:6px">Inputs</h4>
              <div class="cv-grid-2">
                <div class="cv-io"><input id="vol_ml" type="number" step="any" placeholder="Volume"><span>mL</span></div>
                <div class="cv-io"><input id="density" type="number" step="any" placeholder="Density" value="0.979"><span>g/mL</span></div>
              </div>
              <div class="cv-grid-3" style="margin-top:6px">
                <div class="cv-io" style="margin:0"><span class="cv-muted">Factor ‚â§ 1 mL</span></div>
                <div class="cv-io" style="margin:0"><input id="k_small" type="number" step="any" value="1.15"><span>k</span></div>
                <div></div>
                <div class="cv-io" style="margin:0"><span class="cv-muted">Factor &gt; 1 mL</span></div>
                <div class="cv-io" style="margin:0"><input id="k_large" type="number" step="any" value="1.06"><span>k</span></div>
                <div></div>
              </div>

              <p class="cv-muted" style="margin:8px 0 4px">
                The mL you enter decides which factor applies (‚â§1 mL uses k=1.15, otherwise k=1.06). Results on the right update automatically.
              </p>

              <div style="margin-top:8px">
                <div class="cv-io"><input id="ml_to_l" type="number" step="any" placeholder="mL ‚Üí L (enter mL)"><span>mL</span></div>
                <div class="cv-io"><span class="cv-out" id="liters_out">‚Äî</span><span class="cv-muted">L</span></div>

                <div class="cv-io" style="margin-top:6px"><input id="l_to_ml" type="number" step="any" placeholder="L ‚Üí mL (enter L)"><span>L</span></div>
                <div class="cv-io"><span class="cv-out" id="ml_from_l_out">‚Äî</span><span class="cv-muted">mL</span></div>
              </div>

              <p class="cv-muted" style="margin-top:6px">mass (g) = volume (mL) √ó density (g/mL) √ó k; mg = g √ó 1000.</p>
            </div>

            <!-- Results (unchanged behavior) -->
            <div>
              <h4 style="margin-bottom:6px">Results</h4>
              <table class="cv-table">
                <tbody id="res_small">
                  <tr><td class="cv-muted">mg (‚â§ 1 mL, k=<span id="k_small_view">1.15</span>)</td><td class="cv-right" id="mg_small">‚Äî</td></tr>
                  <tr><td class="cv-muted">g  (‚â§ 1 mL, k=<span id="k_small_view2">1.15</span>)</td><td class="cv-right" id="g_small">‚Äî</td></tr>
                </tbody>
                <tbody id="res_large" class="hidden">
                  <tr><td class="cv-muted">mg (&gt; 1 mL, k=<span id="k_large_view">1.06</span>)</td><td class="cv-right" id="mg_large">‚Äî</td></tr>
                  <tr><td class="cv-muted">g  (&gt; 1 mL, k=<span id="k_large_view2">1.06</span>)</td><td class="cv-right" id="g_large">‚Äî</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- SCRATCHPAD -->
    <div class="card section" id="notes" style="margin-top:16px">
      <div class="hd"><div>Scratchpad</div><button id="clearNotes" class="pill">Clear</button></div>
      <div class="bd"><textarea id="notesBox" placeholder="Jot quick notes‚Ä¶"></textarea></div>
    </div>

    <div class="btm"><a class="btn-top" href="#top">Top</a></div>
    <div class="footer">‚ú¶ Crafted by Jordan Moddes ¬∑ Built with GPT-5 Thinking ‚ú¶</div>
  </div>

<script>
  /* ========= CONFIG ========= */
  const WORKER_BASE = "https://jmoddashboard.jmodwork.workers.dev";
  const GOOGLE_MAPS_API_KEY = "AIzaSyCePcq9W-S5yxscXJ2N2MBMoGtpeTAXZnQ";

  const A = "2670 S AW Grimes Blvd, Round Rock, TX 78664";
  const B = "411 W Main St, Round Rock, TX 78664";

  const WEATHER_ZIPS = ["78664","53158","60030","44115"];
  const STOCKS = ["BRK.A","BRK.B","AAPL","NVDA","AXP","DAL","HHH","ABNB","SNAP","MOS","RIVN","KO","FWONK","TSLA","AMZN","GNW"];
  const EVENTS_ZIP = "78664";

  const COINS = [
    { id:"bitcoin",  symbol:"BTC" },
    { id:"ethereum", symbol:"ETH" },
    { id:"solana",   symbol:"SOL" },
    { id:"dogecoin", symbol:"DOGE" }
  ];

  /* ========= HELPERS ========= */
  const $ = s => document.querySelector(s);
  const enc = s => encodeURIComponent(s).replace(/%20/g,'+');
  const toF = c => (c*9/5)+32;
  const todayMMDDYYYY = () => {
    const d = new Date(); const mm=String(d.getMonth()+1).padStart(2,"0");
    const dd=String(d.getDate()).padStart(2,"0"); const yy=d.getFullYear();
    return `${mm}/${dd}/${yy}`;
  };
  const iconFor = code => ({0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üå¶Ô∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",71:"‚ùÑÔ∏è",73:"‚ùÑÔ∏è",75:"‚ùÑÔ∏è",80:"üå¶Ô∏è",81:"üå¶Ô∏è",82:"üåßÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"}[code] || "üå°Ô∏è");
  const fmt = (x,d=3)=> (Number.isFinite(x)? Number(x).toFixed(d) : "‚Äî");

  /* ========= TICKER ========= */
  async function loadTicker(){
    try{
      const r = await fetch(`${WORKER_BASE}/ticker?sources=nfl,f1,general`);
      const items = await r.json();
      const twice = items.concat(items);
      $("#ticker").innerHTML = twice.map(x=>`<span class="tick-item">‚Ä¢ ${x.title}</span>`).join("");
    }catch{
      $("#ticker").innerHTML = `<span class="tick-item">Ticker unavailable</span>`;
    }
  }

  /* ========= TRAFFIC ========= */
  const googleEmbed = (o,d)=>`https://www.google.com/maps/embed/v1/directions?key=${GOOGLE_MAPS_API_KEY}&origin=${enc(o)}&destination=${enc(d)}&mode=driving`;
  function updateTraffic(){ $("#map1").src=googleEmbed(A,B); $("#map2").src=googleEmbed(B,A); }

  /* ========= WEATHER ========= */
  async function wx(lat,lon){
    const u = `${WORKER_BASE}/wx?lat=${lat}&lon=${lon}`;
    const r = await fetch(u);
    if (r.ok) return r.json();
    const url = new URL("https://api.open-meteo.com/v1/forecast");
    url.search = new URLSearchParams({
      latitude: lat, longitude: lon, timezone:"auto", wind_speed_unit:"mph",
      current:"temperature_2m,apparent_temperature,wind_speed_10m,weather_code",
      daily:"temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code",
      hourly:"temperature_2m,weather_code"
    }).toString();
    const r2 = await fetch(url); return r2.json();
  }
  async function geo(zip){
    const r = await fetch(`${WORKER_BASE}/geo?zip=${zip}`);
    if (!r.ok) throw new Error("geo");
    return r.json();
  }
  async function loadWeather(){
    const host = $("#weatherList"); host.innerHTML = "";
    for (const zip of WEATHER_ZIPS){
      try{
        const g = await geo(zip);
        const data = await wx(g.lat, g.lon);
        const cur = data.current;
        const minC = data.daily.temperature_2m_min[0];
        const maxC = data.daily.temperature_2m_max[0];

        const times = data.hourly.time.map(t=>new Date(t));
        let i = times.findIndex(t=>t>=new Date()); if (i<0) i=0;
        const hrs = [];
        for(let k=0;k<5 && i+k<times.length;k++){
          hrs.push({
            h: times[i+k].getHours().toString().padStart(2,"0"),
            t: data.hourly.temperature_2m[i+k],
            c: data.hourly.weather_code[i+k]
          });
        }

        const div = document.createElement("div"); div.className="sym";
        div.innerHTML = `
          <div class="top">
            <div><strong>${g.name || zip}</strong></div>
            <div class="mini">${Math.round(cur.wind_speed_10m)} mph wind</div>
          </div>
          <div class="price">${Math.round(toF(cur.temperature_2m))}¬∞F / ${Math.round(cur.temperature_2m)}¬∞C</div>
          <div class="mini muted">Feels ${Math.round(toF(cur.apparent_temperature))}¬∞F ¬∑ Today ${Math.round(toF(minC))}¬∞F ‚Äì ${Math.round(toF(maxC))}¬∞F</div>
          <div class="hrow">
            ${hrs.map(h=>`
            <div class="hchip">
              <div class="ico">${iconFor(h.c)}</div>
              <div class="t mini">${Math.round(toF(h.t))}¬∞F</div>
              <div class="mini muted">${h.h}:00</div>
            </div>`).join("")}
          </div>`;
        host.appendChild(div);
      }catch(e){
        const div = document.createElement("div"); div.className="sym";
        div.innerHTML = `<div class="top"><strong>${zip}</strong></div><div class="mini muted">Weather unavailable</div>`;
        host.appendChild(div);
      }
    }
  }

  /* ========= SUN (Visualization) ========= */
  async function loadSun(){
    $("#sunDate").textContent = todayMMDDYYYY();
    let s=null;
    try{
      const g = await geo(WEATHER_ZIPS[0]);
      const u = new URL("https://api.sunrisesunset.io/json");
      u.search = new URLSearchParams({ lat:g.lat, lng:g.lon, timezone:"auto" }).toString();
      const r = await fetch(u); const j = await r.json();
      s = j?.results;
    }catch{}
    if (!(s?.sunrise && s?.sunset)){ $("#sunLine").textContent="Unavailable"; return; }

    const sunrise = s.sunrise; const sunset = s.sunset; const noon = s.solar_noon || "";
    $("#sunLine").textContent = `Sunrise ${sunrise} ¬∑ Solar Noon ${noon || "‚Äî"} ¬∑ Sunset ${sunset}`;

    // Simple SVG viz: positions along a 0..100 scale
    const W = 100, H = 40, xL = 10, xR = 90, yBase = 30, yPeak = 6;
    const arc = `M ${xL},${yBase} Q ${(xL+xR)/2},${yPeak} ${xR},${yBase}`;

    // Determine marker position at load
    const now = new Date();
    const today = now.toLocaleDateString(undefined,{year:'numeric',month:'2-digit',day:'2-digit'}).replace(/(\d{2})\/(\d{2})\/(\d{4})/,'$3-$1-$2');
    function parseLocal(t){
      // e.g., "6:49:54 AM" -> todayT local
      return new Date(`${today} ${t}`);
    }
    const sr = parseLocal(sunrise); const ss = parseLocal(sunset);
    let marker = { x: xL, y: yBase, day:false, label: now.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) };

    if (now >= sr && now <= ss){
      const p = (now - sr) / (ss - sr); // 0..1
      const x = xL + (xR - xL) * p;
      // approximate arc y via quadratic peak
      const y = yBase - (yBase - yPeak) * (1 - Math.pow(2*p-1,2)); // smooth hump
      marker = { x, y, day:true, label: now.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) };
    }else{
      // night: place below line, left if before sunrise, right if after sunset
      const x = (now < sr) ? xL - 4 : xR + 4;
      const y = yBase + 6;
      marker = { x, y, day:false, label: now.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) };
    }

    $("#sunViz").innerHTML = `
      <svg viewBox="0 0 ${W} ${H}" preserveAspectRatio="xMidYMid meet" style="width:100%;height:120px">
        <!-- dayline -->
        <line x1="${xL}" y1="${yBase}" x2="${xR}" y2="${yBase}" stroke="rgba(255,255,255,.35)" stroke-width="1.2"/>
        <!-- ticks -->
        <line x1="${xL}" y1="${yBase-6}" x2="${xL}" y2="${yBase+6}" stroke="rgba(255,255,255,.45)" stroke-width="1.2"/>
        <line x1="${xR}" y1="${yBase-6}" x2="${xR}" y2="${yBase+6}" stroke="rgba(255,255,255,.45)" stroke-width="1.2"/>
        <!-- arc -->
        <path d="${arc}" fill="none" stroke="rgba(255,209,102,.8)" stroke-width="1.2"/>
        <!-- labels -->
        <text x="${xL}" y="${yBase+12}" font-size="4" fill="#cbd5e1" text-anchor="start">${sunrise}</text>
        <text x="${xR}" y="${yBase+12}" font-size="4" fill="#cbd5e1" text-anchor="end">${sunset}</text>
        ${noon ? `<text x="${(xL+xR)/2}" y="${yPeak-2}" font-size="4" fill="#cbd5e1" text-anchor="middle">Noon ${noon}</text>` : ""}
        <!-- marker -->
        ${marker.day
          ? `<circle cx="${marker.x}" cy="${marker.y}" r="2.4" fill="#ffd166"><title>Now: ${marker.label} (day)</title></circle>`
          : `<circle cx="${marker.x}" cy="${marker.y}" r="2.4" fill="none" stroke="#ffd166" stroke-width="1.2"><title>Now: ${marker.label} (night)</title></circle>`
        }
      </svg>`;
  }

  /* ========= VOTD ========= */
  async function loadVOTD(){
    $("#votdDate").textContent = todayMMDDYYYY();
    try{
      const r = await fetch(`${WORKER_BASE}/votd`);
      if (r.ok){
        const j = await r.json();
        if (j?.text){
          $("#votdText").textContent = j.text;
          $("#votdRef").textContent  = j.ref || "";
          return;
        }
      }
    }catch{}
    try{
      const r = await fetch("https://labs.bible.org/api/?passage=votd&type=json");
      const j = await r.json();
      const v = j?.[0];
      if (v){
        $("#votdText").textContent = v.text;
        $("#votdRef").textContent  = `${v.bookname} ${v.chapter}:${v.verse}`;
        return;
      }
    }catch{}
    $("#votdText").textContent = "Verse unavailable."; $("#votdRef").textContent = "";
  }

  /* ========= EVENTS ========= */
  async function loadEvents(){
    const host = $("#eventsList"); host.innerHTML = "";
    try{
      const r = await fetch(`${WORKER_BASE}/events?postalCode=${encodeURIComponent(EVENTS_ZIP)}`);
      const j = await r.json();
      if (Array.isArray(j) && j.length){
        j.slice(0,8).forEach(ev=>{
          const d = document.createElement("div"); d.className="sym";
          d.innerHTML = `
            <div class="top"><div><strong>${ev.name||"Event"}</strong></div>
            <div class="mini muted">${ev.city||""} ${ev.state||""}</div></div>
            <div class="mini">${ev.date||""}</div>
            <div class="mini"><a class="pill" href="${ev.url||"#"}" target="_blank" rel="noopener">Details</a></div>`;
          host.appendChild(d);
        });
        return;
      }
      host.innerHTML = `<div class="mini muted">No events or missing TM_KEY on Worker.</div>`;
    }catch{
      host.innerHTML = `<div class="mini muted">Events unavailable.</div>`;
    }
  }

  /* ========= STOCKS ========= */
  async function loadStocks(){
    const host = $("#stocksList"); host.innerHTML = "";
    try{
      const url = `${WORKER_BASE}/quotes?symbols=${encodeURIComponent(STOCKS.join(","))}`;
      const r = await fetch(url); const rows = await r.json();
      if (!Array.isArray(rows) || !rows.length){
        host.innerHTML = `<div class="mini muted">Quotes unavailable.</div>`; return;
      }
      rows.forEach(q=>{
        const chg = q.changePercent; const badge = chg==null ? "muted" : (chg>=0?"chg up":"chg down");
        const div = document.createElement("div"); div.className="sym";
        div.innerHTML = `
          <div class="top">
            <div><strong>${q.symbol}</strong> <span class="mini muted">${q.name||""}</span></div>
            <div class="mini ${badge}">${chg==null?"‚Äî":`${chg>=0?"+":""}${chg.toFixed(2)}%`}</div>
          </div>
          <div class="price">$${Number(q.price||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}</div>`;
        host.appendChild(div);
      });
    }catch{
      host.innerHTML = `<div class="mini muted">Quotes unavailable.</div>`;
    }
  }

  /* ========= CRYPTO ========= */
  async function loadCrypto(){
    const host = $("#cryptoList"); const status = $("#cryptoStatus");
    host.innerHTML = ""; status.textContent = "Loading‚Ä¶";
    try{
      const ids = COINS.map(c=>c.id).join(',');
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`;
      const r = await fetch(url); if(!r.ok) throw 0;
      const j = await r.json();
      COINS.forEach(c=>{
        const d = j[c.id]; if(!d) return;
        const pct = d.usd_24h_change ?? 0;
        const cls = pct>=0 ? "chg up" : "chg down";
        const div = document.createElement("div"); div.className="sym";
        div.innerHTML = `
          <div class="top">
            <div><strong>${c.symbol}</strong> <span class="mini muted">${c.id}</span></div>
            <div class="mini ${cls}">${(pct>=0?"+":"")}${pct.toFixed(2)}%</div>
          </div>
          <div class="price">$${Number(d.usd||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}</div>`;
        host.appendChild(div);
      });
      status.textContent = "Live via CoinGecko";
    }catch(e){
      status.textContent = "Crypto unavailable.";
    }
  }
  $("#cryptoRefresh").addEventListener("click", loadCrypto);

  /* ========= PELOSI ========= */
  async function loadPelosi(){
    const st = $("#pelosiStatus"); const tb = $("#pelosiTable tbody");
    tb.innerHTML = ""; st.textContent = "Loading‚Ä¶";
    try{
      const r = await fetch(`${WORKER_BASE}/pelosi`);
      const rows = await r.json();
      rows.forEach(rw=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${rw.disclosure_date||""}</td>
          <td>${rw.transaction_date||""}</td>
          <td>${rw.ticker||rw.asset_description||""}</td>
          <td>${rw.type||""}</td>
          <td>${rw.amount||""}</td>
          <td>${rw.ptr_link?`<a class="pill" href="${rw.ptr_link}" target="_blank" rel="noopener">PTR</a>`:""}</td>`;
        tb.appendChild(tr);
      });
      st.textContent = rows.length ? "Loaded." : "No trades found.";
    }catch(e){
      st.textContent = "Could not load trades.";
    }
  }

  /* ========= CONVERSIONS ========= */
  // top tiles
  const f_in = $("#f_in"), c_out = $("#c_out");
  const c_in = $("#c_in"), f_out = $("#f_out");
  const m_in = $("#m_in"), ft_out = $("#ft_out");
  const in_in = $("#in_in"), cm_out = $("#cm_out");

  f_in?.addEventListener('input', ()=>{ const F=parseFloat(f_in.value); c_out.textContent = fmt((F-32)*5/9,2); });
  c_in?.addEventListener('input', ()=>{ const C=parseFloat(c_in.value); f_out.textContent = fmt((C*9/5)+32,2); });
  m_in?.addEventListener('input', ()=>{ const m=parseFloat(m_in.value); ft_out.textContent = fmt(m*3.280839895,4); });
  in_in?.addEventListener('input', ()=>{ const inch=parseFloat(in_in.value); cm_out.textContent = fmt(inch*2.54,2); });

  // work conversions
  const vol_ml = $("#vol_ml"), density = $("#density"), k_small = $("#k_small"), k_large = $("#k_large");
  const mg_small = $("#mg_small"), g_small = $("#g_small"), mg_large = $("#mg_large"), g_large = $("#g_large");
  const res_small = $("#res_small"), res_large = $("#res_large");
  const k_small_view=$("#k_small_view"), k_small_view2=$("#k_small_view2");
  const k_large_view=$("#k_large_view"), k_large_view2=$("#k_large_view2");
  const ml_to_l = $("#ml_to_l"), liters_out = $("#liters_out");
  const l_to_ml = $("#l_to_ml"), ml_from_l_out = $("#ml_from_l_out");

  function updateWork(){
    const V  = parseFloat(vol_ml.value);
    const rho= parseFloat(density.value);
    const ks = parseFloat(k_small.value);
    const kl = parseFloat(k_large.value);

    if (k_small_view){ k_small_view.textContent = isFinite(ks)? ks : '‚Äî'; k_small_view2.textContent = isFinite(ks)? ks : '‚Äî'; }
    if (k_large_view){ k_large_view.textContent = isFinite(kl)? kl : '‚Äî'; k_large_view2.textContent = isFinite(kl)? kl : '‚Äî'; }

    if (Number.isFinite(V)){
      if (V <= 1.000000000){
        res_small.classList.remove('hidden'); res_large.classList.add('hidden');
        const gS = V * rho * ks;
        g_small.textContent  = fmt(gS,3);
        mg_small.textContent = fmt(gS*1000,3);
        g_large.textContent  = '‚Äî'; mg_large.textContent='‚Äî';
      }else{
        res_large.classList.remove('hidden'); res_small.classList.add('hidden');
        const gL = V * rho * kl;
        g_large.textContent  = fmt(gL,3);
        mg_large.textContent = fmt(gL*1000,3);
        g_small.textContent  = '‚Äî'; mg_small.textContent='‚Äî';
      }
    }else{
      res_small.classList.add('hidden'); res_large.classList.add('hidden');
      ['g_small','mg_small','g_large','mg_large'].forEach(id=>{ const el=$("#"+id); if(el) el.textContent='‚Äî'; });
    }
  }
  [vol_ml,density,k_small,k_large].forEach(el=> el?.addEventListener('input', updateWork));

  ml_to_l?.addEventListener('input', ()=>{ const mL = parseFloat(ml_to_l.value); liters_out.textContent = fmt(mL/1000,6); });
  l_to_ml?.addEventListener('input', ()=>{ const L = parseFloat(l_to_ml.value); ml_from_l_out.textContent = fmt(L*1000,3); });

  /* ========= NOTES / INIT ========= */
  $("#todayBadge").textContent = todayMMDDYYYY();
  $("#votdDate").textContent  = todayMMDDYYYY();
  $("#clearNotes").onclick = ()=>{ const t=$("#notesBox"); t.value=""; localStorage.removeItem("dashboard-notes"); };
  const tSaved = localStorage.getItem("dashboard-notes")||""; $("#notesBox").value = tSaved;
  $("#notesBox").addEventListener("input", e=>localStorage.setItem("dashboard-notes", e.target.value));

  loadTicker();
  updateTraffic(); setInterval(updateTraffic, 120000);
  loadWeather();
  loadSun(); // compute once at load
  loadVOTD(); setInterval(loadVOTD, 30*60*1000);
  loadEvents();
  loadStocks(); setInterval(loadStocks, 60000);
  loadCrypto(); setInterval(loadCrypto, 60000);
  loadPelosi();
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jmod Co. — Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Basic helpers */
    .card { @apply bg-white/70 dark:bg-zinc-900/70 backdrop-blur rounded-2xl shadow p-4 md:p-6; }
    .kpi  { @apply text-2xl md:text-3xl font-semibold; }
    .sub  { @apply text-xs opacity-70; }
    .table { @apply w-full text-sm border-collapse; }
    .table th, .table td { @apply border border-zinc-200 dark:border-zinc-800 p-2; }
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-zinc-100 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 min-h-screen">

  <!-- NAV -->
  <header class="sticky top-0 z-50 border-b border-zinc-200 dark:border-zinc-800 bg-white/80 dark:bg-zinc-950/80 backdrop-blur">
    <nav class="max-w-6xl mx-auto flex items-center justify-between px-3 py-2">
      <div class="flex items-center gap-2">
        <span class="font-bold tracking-tight">Jmod Co. Dashboard</span>
      </div>
      <ul class="flex items-center gap-4 text-sm">
        <li><a href="#overview"   class="hover:underline">Overview</a></li>
        <li><a href="#stocks"     class="hover:underline">Stocks</a></li>
        <li><a href="#crypto"     class="hover:underline">Crypto</a></li>
        <li><a href="#pelosi"     class="hover:underline">Pelosi</a></li>
        <li><a href="#conversions" class="hover:underline">Conversions</a></li>
        <li><a href="#scratchpad" class="hover:underline">Scratchpad</a></li>
      </ul>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-3 py-6 space-y-6">

    <!-- OVERVIEW -->
    <section id="overview" class="grid md:grid-cols-3 gap-4">
      <div class="card">
        <div class="sub">Last updated</div>
        <div id="last-updated" class="kpi">—</div>
      </div>
      <div class="card">
        <div class="sub">Tracked Crypto</div>
        <div id="kpi-crypto" class="kpi">—</div>
      </div>
      <div class="card">
        <div class="sub">Pelosi Rows Loaded</div>
        <div id="kpi-pelosi" class="kpi">—</div>
      </div>
    </section>

    <!-- STOCKS (placeholder, in case you wire later) -->
    <section id="stocks" class="card">
      <h2 class="text-xl font-semibold mb-3">Stocks</h2>
      <p class="text-sm opacity-75">Placeholder for your equity tickers. We can wire a quotes API later (e.g., Alpha Vantage, Polygon).</p>
    </section>

    <!-- CRYPTO -->
    <section id="crypto" class="card">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-semibold">Crypto (live)</h2>
        <button id="refresh-crypto" class="text-sm px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-900">
          Refresh
        </button>
      </div>
      <div id="crypto-status" class="sub mb-2">Loading…</div>
      <table class="table" id="crypto-table">
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Price (USD)</th>
            <th>24h Δ%</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p class="sub mt-2">Source: CoinGecko Simple Price API. Auto-refreshes every 5 minutes.</p>
    </section>

    <!-- PELOSI TRADES -->
    <section id="pelosi" class="card">
      <h2 class="text-xl font-semibold mb-3">Nancy Pelosi Disclosed Trades (latest 50)</h2>
      <div id="pelosi-status" class="sub mb-2">Loading…</div>
      <div class="overflow-auto">
        <table id="pelosi-table" class="table hidden">
          <thead>
            <tr>
              <th>Disclosed</th>
              <th>Traded</th>
              <th>Ticker / Asset</th>
              <th>Type</th>
              <th>Amount (range)</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="sub mt-2">Data via House Stock Watcher (values reported in ranges and can be delayed up to 45 days).</p>
    </section>

    <!-- CONVERSIONS CHEAT SHEET (above scratchpad) -->
    <section id="conversions" class="card">
      <h2 class="text-xl font-semibold mb-4">Conversions — Quick Cheat Sheet</h2>

      <!-- mini calculators -->
      <div class="grid md:grid-cols-3 gap-4 mb-6">
        <!-- Mass -->
        <div class="p-3 rounded-xl border border-zinc-200 dark:border-zinc-800">
          <div class="font-medium mb-2">Mass (mg ↔ g ↔ kg)</div>
          <div class="space-y-2 text-sm">
            <label class="block">mg → g
              <input id="mg" type="number" step="any" class="mt-1 w-full rounded border border-zinc-300 dark:border-zinc-700 bg-transparent p-2" placeholder="mg">
            </label>
            <div class="flex gap-2">
              <button data-action="mg2g" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">To g</button>
              <button data-action="mg2kg" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">To kg</button>
            </div>
            <div id="mass-out" class="sub"></div>
          </div>
          <div class="mt-3 text-xs opacity-75">
            1 g = 1000 mg · 1 kg = 1000 g
          </div>
        </div>

        <!-- Length -->
        <div class="p-3 rounded-xl border border-zinc-200 dark:border-zinc-800">
          <div class="font-medium mb-2">Length (in ↔ cm)</div>
          <div class="space-y-2 text-sm">
            <label class="block">inches
              <input id="inch" type="number" step="any" class="mt-1 w-full rounded border border-zinc-300 dark:border-zinc-700 bg-transparent p-2" placeholder="in">
            </label>
            <div class="flex gap-2">
              <button data-action="in2cm" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">To cm</button>
              <button data-action="cm2in" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">cm → in</button>
            </div>
            <label class="block mt-2">centimeters
              <input id="cm" type="number" step="any" class="mt-1 w-full rounded border border-zinc-300 dark:border-zinc-700 bg-transparent p-2" placeholder="cm">
            </label>
            <div id="len-out" class="sub"></div>
          </div>
          <div class="mt-3 text-xs opacity-75">
            1 in = 2.54 cm
          </div>
        </div>

        <!-- Temperature -->
        <div class="p-3 rounded-xl border border-zinc-200 dark:border-zinc-800">
          <div class="font-medium mb-2">Temperature (°F ↔ °C)</div>
          <div class="space-y-2 text-sm">
            <label class="block">°F
              <input id="f" type="number" step="any" class="mt-1 w-full rounded border border-zinc-300 dark:border-zinc-700 bg-transparent p-2" placeholder="F">
            </label>
            <div class="flex gap-2">
              <button data-action="f2c" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">To °C</button>
              <button data-action="c2f" class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700">°C → °F</button>
            </div>
            <label class="block mt-2">°C
              <input id="c" type="number" step="any" class="mt-1 w-full rounded border border-zinc-300 dark:border-zinc-700 bg-transparent p-2" placeholder="C">
            </label>
            <div id="temp-out" class="sub"></div>
          </div>
          <div class="mt-3 text-xs opacity-75">
            °C = (°F − 32) × 5/9 · °F = (°C × 9/5) + 32
          </div>
        </div>
      </div>

      <!-- static cheat sheet -->
      <div class="overflow-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Category</th><th>Rule / Factor</th><th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Mass</td><td>1 g = 1000 mg · 1 kg = 1000 g</td><td>To convert mg → g, divide by 1000</td></tr>
            <tr><td>Length</td><td>1 in = 2.54 cm</td><td>cm → in = cm / 2.54</td></tr>
            <tr><td>Volume</td><td>1 L = 33.814 fl oz (US)</td><td>1 gal (US) = 3.785 L</td></tr>
            <tr><td>Weight</td><td>1 lb = 16 oz</td><td>kg ≈ lb / 2.20462</td></tr>
            <tr><td>Temperature</td><td>°C = (°F − 32) × 5/9</td><td>°F = (°C × 9/5) + 32</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- SCRATCHPAD -->
    <section id="scratchpad" class="card">
      <h2 class="text-xl font-semibold mb-3">Scratchpad</h2>
      <textarea class="w-full h-64 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-transparent p-3" placeholder="Jot notes here…"></textarea>
      <div class="mt-3 sub">Tip: this is local-only unless you wire it to storage.</div>
    </section>

    <!-- FOOTER -->
    <footer class="py-10 text-center opacity-70">
      <div id="copyright"></div>
      <div>Built for small business clarity.</div>
    </footer>

  </main>

  <script>
    // ————— General
    (function setTimeAndCopyright(){
      const now = new Date();
      document.getElementById('last-updated').textContent = now.toLocaleString();
      const copy = document.getElementById('copyright');
      if (copy) copy.textContent = `© ${new Date().getFullYear()} Jmod Co.`;
    })();

    // ————— Crypto (CoinGecko)
    const CRYPTO = [
      { id: 'bitcoin',   symbol: 'BTC' },
      { id: 'ethereum',  symbol: 'ETH' },
      { id: 'solana',    symbol: 'SOL' },
      { id: 'dogecoin',  symbol: 'DOGE' },
    ];
    const cgUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${CRYPTO.map(c=>c.id).join(',')}&vs_currencies=usd&include_24hr_change=true`;

    async function loadCrypto(){
      const status = document.getElementById('crypto-status');
      const tbody  = document.querySelector('#crypto-table tbody');
      try {
        status.textContent = 'Loading…';
        const r = await fetch(cgUrl, { mode: 'cors' });
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        const data = await r.json();
        tbody.innerHTML = '';
        let count = 0;
        for (const c of CRYPTO) {
          const row = data[c.id];
          if (!row) continue;
          count++;
          const price = row.usd?.toLocaleString(undefined, { style:'currency', currency:'USD' }) ?? '—';
          const chg   = (row.usd_24h_change ?? 0);
          const chgFmt = (chg>=0?'+':'') + chg.toFixed(2) + '%';
          const chgClass = chg>=0 ? 'text-green-600' : 'text-red-600';
          tbody.insertAdjacentHTML('beforeend', `
            <tr>
              <td>${c.symbol}</td>
              <td>${price}</td>
              <td class="${chgClass}">${chgFmt}</td>
            </tr>
          `);
        }
        document.getElementById('kpi-crypto').textContent = count.toString();
        status.textContent = 'Live via CoinGecko';
      } catch (e) {
        status.textContent = 'Could not load crypto (' + e.message + ').';
      }
    }
    loadCrypto();
    document.getElementById('refresh-crypto').addEventListener('click', loadCrypto);
    // Auto-refresh every 5 minutes
    setInterval(loadCrypto, 5 * 60 * 1000);

    // ————— Pelosi trades (House Stock Watcher)
    (async () => {
      const status = document.getElementById('pelosi-status');
      const table  = document.getElementById('pelosi-table');
      const tbody  = table.querySelector('tbody');

      const SRC = 'https://house-stock-watcher-data.s3-us-west-2.amazonaws.com/data/all_transactions.json';
      try {
        status.textContent = 'Loading…';
        const resp = await fetch(SRC, { mode: 'cors' });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const all = await resp.json();

        const rows = all
          .filter(r => r.representative && r.representative.includes('Nancy Pelosi'))
          .sort((a, b) => new Date(b.disclosure_date) - new Date(a.disclosure_date))
          .slice(0, 50);

        document.getElementById('kpi-pelosi').textContent = rows.length.toString();

        if (!rows.length) {
          status.textContent = 'No Pelosi trades found in this feed.';
          return;
        }

        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.disclosure_date || ''}</td>
            <td>${r.transaction_date || ''}</td>
            <td>${r.ticker || r.asset_description || ''}</td>
            <td>${r.type || ''}</td>
            <td>${r.amount || ''}</td>
            <td>${r.ptr_link ? `<a class="text-blue-600 underline" href="${r.ptr_link}" target="_blank" rel="noopener">PTR</a>` : ''}</td>
          </tr>
        `).join('');

        table.classList.remove('hidden');
        status.textContent = 'Loaded.';
      } catch (err) {
        status.textContent = `Couldn’t load data (${err.message}).`;
      }
    })();

    // ————— Mini converters
    function sel(id){ return document.getElementById(id); }
    document.querySelectorAll('[data-action]').forEach(btn=>{
      btn.addEventListener('click', () => {
        const a = btn.getAttribute('data-action');
        if (a === 'mg2g') {
          const mg = parseFloat(sel('mg').value || '0');
          sel('mass-out').textContent = `${mg} mg = ${(mg/1000).toFixed(6)} g`;
        }
        if (a === 'mg2kg') {
          const mg = parseFloat(sel('mg').value || '0');
          sel('mass-out').textContent = `${mg} mg = ${(mg/1e6).toFixed(9)} kg`;
        }
        if (a === 'in2cm') {
          const inch = parseFloat(sel('inch').value || '0');
          sel('len-out').textContent = `${inch} in = ${(inch*2.54).toFixed(4)} cm`;
        }
        if (a === 'cm2in') {
          const cm = parseFloat(sel('cm').value || '0');
          sel('len-out').textContent = `${cm} cm = ${(cm/2.54).toFixed(4)} in`;
        }
        if (a === 'f2c') {
          const f = parseFloat(sel('f').value || '0');
          sel('temp-out').textContent = `${f} °F = ${((f-32)*5/9).toFixed(2)} °C`;
        }
        if (a === 'c2f') {
          const c = parseFloat(sel('c').value || '0');
          sel('temp-out').textContent = `${c} °C = ${(c*9/5+32).toFixed(2)} °F`;
        }
      });
    });
  </script>
</body>
</html>
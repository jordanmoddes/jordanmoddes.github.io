<!doctype html>
<html lang="en" id="top">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jmod Co. — Dashboard</title>
<meta name="color-scheme" content="dark light" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root {
    --card: rgba(18,18,22,.60);
    --stroke: rgba(255,255,255,.08);
    --ring: rgba(120,119,198,.25);
  }
  html { scroll-behavior:smooth; }
  body {
    background:
      radial-gradient(1200px 800px at 10% -10%, rgba(34,35,60,.25), transparent 40%),
      radial-gradient(900px 600px at 90% 10%, rgba(232,121,249,.08), transparent 55%),
      linear-gradient(180deg, #0b0b0f, #0f1015 25%, #101117 60%, #0e0f14 100%);
    color: #eef0f6;
  }
  .wrap    { max-width: 1100px; }
  .card    { background: var(--card); border:1px solid var(--stroke); border-radius:20px; padding:16px; }
  .pill    { border:1px solid var(--stroke); border-radius:999px; padding:6px 10px; font-size:.8rem; }
  .tile    { border:1px solid var(--stroke); border-radius:14px; padding:12px; }
  .tile-sm { display:flex; align-items:center; justify-content:space-between; min-height:70px; }
  .k       { font-weight:700; font-size:1.9rem; letter-spacing:.2px; }
  .sub     { opacity:.75; font-size:.85rem; }
  .btn     { border:1px solid var(--stroke); padding:6px 10px; border-radius:12px; font-size:.8rem; }
  .hourchip { border:1px solid var(--stroke); border-radius:12px; padding:10px; width:78px; text-align:center; }
  .hourchip .ico { display:block; margin:6px auto 2px; }
  .good { color:#16a34a; } .bad { color:#ef4444; }
  .table { width:100%; border-collapse: collapse; }
  .table th,.table td { border-top:1px solid var(--stroke); padding:8px; font-size:.9rem; }
  .hdr { background: rgba(10,10,14,.75); border-bottom:1px solid var(--stroke); backdrop-filter: blur(8px); }
  .btn:focus-visible, a:focus-visible, input:focus-visible, textarea:focus-visible { outline: 2px solid var(--ring); outline-offset: 2px; }

  /* YouVersion-flavored Verse panel */
  .verse-panel {
    position: relative;
    border-radius: 18px;
    padding: 18px;
    background: linear-gradient(180deg, rgba(34,36,52,.95), rgba(16,18,28,.95));
    border: 1px solid rgba(255,255,255,.08);
    box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset, 0 10px 30px rgba(120,119,198,.15), 0 20px 60px rgba(232,121,249,.10);
  }
  .verse-panel::before{
    content:"";
    position:absolute; inset:-1px;
    border-radius:20px; pointer-events:none;
    background: linear-gradient(135deg, rgba(232,121,249,.35), rgba(56,189,248,.35));
    mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    padding:1px; border-radius:20px; opacity:.35;
  }
  .verse-quote{ font-size:1.25rem; line-height:1.9rem; }
  .verse-accent{ color:#93c5fd; }

  /* --- Sports tickers --- */
  .ticker{overflow:hidden;white-space:nowrap;border:1px solid var(--stroke);border-radius:14px;padding:8px 0}
  .ticker-track{display:inline-block;padding-left:100%;animation:scroll 35s linear infinite}
  .ticker-item{display:inline-block;margin:0 24px}
  .ticker:hover .ticker-track{animation-play-state:paused}
  @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

  @media (max-width: 640px){
    .k { font-size: 1.6rem; }
    .verse-quote{ font-size:1.1rem; line-height:1.7rem; }
  }
</style>
</head>
<body>

<!-- NAV -->
<header class="hdr sticky top-0 z-50">
  <nav class="wrap mx-auto flex items-center justify-between px-3 py-2">
    <a href="#top" class="font-semibold">Jmod Co. — Dashboard</a>
    <ul class="flex items-center gap-3 text-sm">
      <li><a class="pill" href="/index.html">Resume</a></li>
      <li><a class="pill" href="#events">Local Events</a></li>
      <li><a class="pill" href="#traffic">Traffic</a></li>
      <li><a class="pill" href="#stocks">Stocks</a></li>
      <li><a class="pill" href="#conversions">Conversions</a></li>
    </ul>
  </nav>
</header>

<main class="wrap mx-auto px-3 py-5 space-y-6">

  <!-- Welcome -->
  <section class="card">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold">Welcome</h1>
        <p class="sub mt-1">Tinkering, learning, shipping. Explore anything on display.</p>
      </div>
      <div class="flex gap-2">
        <span id="today-pill" class="pill"></span>
        <span class="pill hidden sm:inline">Live</span>
      </div>
    </div>
  </section>

  <!-- Sports Tickers -->
  <section id="sports" class="card">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">Sports Tickers</h2>
      <button id="t-refresh" class="btn">Refresh</button>
    </div>
    <div class="grid gap-3">
      <div>
        <div class="sub mb-1">NFL</div>
        <div class="ticker"><div id="nfl-track" class="ticker-track"></div></div>
      </div>
      <div>
        <div class="sub mb-1">F1</div>
        <div class="ticker"><div id="f1-track" class="ticker-track"></div></div>
      </div>
    </div>
  </section>

  <!-- Weather -->
  <section id="weather" class="card space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Weather</h2>
      <button id="wx-refresh" class="btn">Refresh</button>
    </div>
    <div id="wx-cards" class="grid gap-4 md:grid-cols-2"></div>

    <div class="card">
      <div class="flex items-center justify-between">
        <div class="text-lg font-semibold">Sunrise • Sunset</div>
        <span id="sun-date" class="pill"></span>
      </div>
      <div id="sun-times" class="sub mt-2">Loading…</div>
    </div>
  </section>

  <!-- Verse + Events side-by-side -->
  <section class="grid gap-4 md:grid-cols-2">
    <!-- Verse -->
    <section id="verse" class="card">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Verse of the Day</h2>
        <button id="v-refresh" class="btn">Refresh</button>
      </div>
      <div id="v-status" class="sub mt-1">Loading…</div>
      <div class="mt-3 verse-panel">
        <div class="flex items-center justify-between">
          <div class="pill inline-block">Verse of the Day</div>
          <div id="v-date" class="sub"></div>
        </div>
        <blockquote id="v-text" class="verse-quote mt-3"></blockquote>
        <div id="v-ref" class="verse-accent mt-2"></div>
      </div>
    </section>

    <!-- Local Events -->
    <section id="events" class="card">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Local Events</h2>
        <span class="pill">next 7–14 days</span>
      </div>
      <div id="events-list" class="mt-3 space-y-3"></div>
      <div class="sub mt-2">Demo feed now; we can swap to Ticketmaster/SeatGeek later.</div>
    </section>
  </section>

  <!-- Traffic side-by-side -->
  <section id="traffic" class="card space-y-4">
    <h2 class="text-xl font-semibold">Traffic</h2>
    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <div class="font-medium mb-2">To Work</div>
        <div class="rounded-2xl overflow-hidden border border-neutral-800 aspect-video">
          <iframe id="map-work" class="w-full h-full" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
      <div>
        <div class="font-medium mb-2">To Home</div>
        <div class="rounded-2xl overflow-hidden border border-neutral-800 aspect-video">
          <iframe id="map-home" class="w-full h-full" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Stocks -->
  <section id="stocks" class="card">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">Stocks</h2>
      <div class="flex items-center gap-2">
        <button id="s-auto" class="btn">auto refresh</button>
        <button id="s-refresh" class="btn">Refresh</button>
      </div>
    </div>
    <div id="s-grid" class="grid gap-3 grid-cols-2 md:grid-cols-4"></div>
    <div id="s-status" class="sub mt-2"></div>
  </section>

  <!-- Crypto -->
  <section id="crypto" class="card">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">Crypto</h2>
      <button id="c-refresh" class="btn">Refresh</button>
    </div>
    <div id="c-grid" class="grid gap-3 grid-cols-2 md:grid-cols-4"></div>
    <div id="c-status" class="sub mt-2"></div>
  </section>

  <!-- Pelosi -->
  <section id="pelosi" class="card">
    <h2 class="text-xl font-semibold mb-2">Nancy Pelosi — Disclosed Trades (latest 50)</h2>
    <div id="p-status" class="sub mb-2">Loading…</div>
    <div class="overflow-auto">
      <table class="table" id="p-table">
        <thead><tr><th>Disclosed</th><th>Traded</th><th>Ticker / Asset</th><th>Type</th><th>Amount</th><th>PTR</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Conversions -->
  <section id="conversions" class="card">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Conversions</h2>
    </div>
    <div class="grid md:grid-cols-3 gap-4 mt-3">
      <div class="card">
        <div class="font-medium mb-2">Mass (mg ↔ g ↔ kg)</div>
        <input id="mg" type="number" step="any" placeholder="mg" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="mg2g">To g</button>
          <button class="btn" data-x="mg2kg">To kg</button>
        </div>
        <div id="mass-out" class="sub mt-2"></div>
      </div>
      <div class="card">
        <div class="font-medium mb-2">Length (in ↔ cm)</div>
        <input id="inch" type="number" step="any" placeholder="inches" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <input id="cm" type="number" step="any" placeholder="centimeters" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2 mt-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="in2cm">To cm</button>
          <button class="btn" data-x="cm2in">cm → in</button>
        </div>
        <div id="len-out" class="sub mt-2"></div>
      </div>
      <div class="card">
        <div class="font-medium mb-2">Temperature (°F ↔ °C)</div>
        <input id="f" type="number" step="any" placeholder="°F" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <input id="c" type="number" step="any" placeholder="°C" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2 mt-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="f2c">To °C</button>
          <button class="btn" data-x="c2f">°C → °F</button>
        </div>
        <div id="temp-out" class="sub mt-2"></div>
      </div>
    </div>
  </section>

  <!-- Scratchpad -->
  <section id="scratchpad" class="card">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Scratchpad</h2>
      <button id="pad-clear" class="btn">Clear</button>
    </div>
    <textarea id="pad" class="w-full h-40 bg-neutral-900 border border-neutral-800 rounded-2xl p-3 mt-2" placeholder="Jot quick notes…"></textarea>
  </section>

  <!-- Footer -->
  <footer class="py-8 text-center sub">
    ✦ Crafted by Jordan Moddes · Built with GPT-5 Thinking ✦
  </footer>
</main>

<script>
/* ====== CONFIG (edit) ====== */
const HOME_ADDR = "411 W Main St, Round Rock, TX";
const WORK_ADDR = "2670 S A.W. Grimes Blvd, Round Rock, TX";
const CITIES = [
  { name:"Round Rock, TX", lat:30.5083, lon:-97.6789 },
  { name:"Pleasant Prairie, WI", lat:42.5531, lon:-87.9334 },
  { name:"Grayslake, IL", lat:42.3445, lon:-88.0417 },
  { name:"Cleveland, OH", lat:41.4993, lon:-81.6944 },
];
const STOCKS = ["BRK.A","BRK.B","AAPL","NVDA","AXP","DAL","HHH","ABNB","SNAP","MOS","RIVN","KO","FWONK","TSLA","AMZN","GNW"];
const COINS = [
  { id:"bitcoin", symbol:"BTC" },
  { id:"ethereum", symbol:"ETH" },
  { id:"solana", symbol:"SOL" },
  { id:"dogecoin", symbol:"DOGE" }
];
/* =========================== */

const $ = (id) => document.getElementById(id);

/* -------- Proxy helpers (CORS-safe) -------- */
async function getText(url){
  try {
    const r = await fetch(url, {mode:'cors'}); if (!r.ok) throw new Error(r.status);
    return await r.text();
  } catch {
    const proxy = `https://r.jina.ai/${url.startsWith('https')?'https':'http'}://${url.replace(/^https?:\/\//,'')}`;
    const r2 = await fetch(proxy, {mode:'cors'}); if (!r2.ok) throw new Error(r2.status);
    return await r2.text();
  }
}
async function getJSON(url){
  const t = await getText(url);
  try { return JSON.parse(t); } catch { return null; }
}

/* meta */
$('today-pill').textContent = new Date().toLocaleDateString();

/* ---------- Sports tickers (NFL + F1) ---------- */
async function fetchRssTitles(url, max=25){
  const xml = await getText(url);
  const titles = Array.from(xml.matchAll(/<title><!\[CDATA\[(.*?)\]\]><\/title>|<title>([^<]+)<\/title>/gi))
    .map(m => (m[1] || m[2] || '').trim())
    .filter(t => t && !/^rss$|^feed$/i.test(t))
    .slice(0, max);
  return titles;
}
async function renderTickers(){
  try{
    const nfl = await fetchRssTitles('https://www.espn.com/espn/rss/nfl/news', 30);
    const f1  = await fetchRssTitles('https://feeds.bbci.co.uk/sport/formula1/rss.xml', 30);

    const nflTrack = $('nfl-track');
    const f1Track  = $('f1-track');

    nflTrack.innerHTML = nfl.map(t => `<span class="ticker-item">• ${t}</span>`).join('') +
                         nfl.map(t => `<span class="ticker-item">• ${t}</span>`).join('');
    f1Track.innerHTML  = f1.map(t  => `<span class="ticker-item">• ${t}</span>`).join('') +
                         f1.map(t  => `<span class="ticker-item">• ${t}</span>`).join('');
  }catch(e){ console.warn('Ticker load error', e); }
}
renderTickers();
document.getElementById('t-refresh').addEventListener('click', renderTickers);

/* ---------- Weather ---------- */
function codeToIcon(code){
  const sun = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" fill="#fde047"/><g stroke="#fde047" stroke-width="2"><path d="M12 1v3"/><path d="M12 20v3"/><path d="M1 12h3"/><path d="M20 12h3"/><path d="M4.2 4.2l2.2 2.2"/><path d="M17.6 17.6l2.2 2.2"/><path d="M4.2 19.8l2.2-2.2"/><path d="M17.6 6.4l2.2-2.2"/></g></svg>';
  const cloud = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 18h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/></svg>';
  const rain = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 16h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><g stroke="#60a5fa" stroke-width="2"><path d="M9 18v3"/><path d="M12 18v3"/><path d="M15 18v3"/></g></svg>';
  const snow = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 16h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><g stroke="#e5e7eb" stroke-width="2"><path d="M9 18l-1 3"/><path d="M12 18l-1 3"/><path d="M15 18l-1 3"/></g></svg>';
  const storm = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 15h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><path d="M12 14l-3 6 5-4h-3l3-4" fill="#f59e0b"/></svg>';
  if ([0,1].includes(code)) return sun;
  if ([2,3,45,48].includes(code)) return cloud;
  if ([61,63,65,51,53,55].includes(code)) return rain;
  if ([71,73,75].includes(code)) return snow;
  if ([95].includes(code)) return storm;
  return cloud;
}
async function getWeather(lat, lon){
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&temperature_unit=fahrenheit&windspeed_unit=mph&forecast_days=1&timezone=auto`;
  const j = await getJSON(url); if(!j) throw new Error('weather'); return j;
}
async function getSun(lat, lon){
  const url = `https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`;
  const j = await getJSON(url); if(!j) throw new Error('sun'); return j;
}
async function renderWeather(){
  const host = $('wx-cards'); host.innerHTML="";
  for (const city of CITIES){
    try{
      const data = await getWeather(city.lat, city.lon);
      const c = data.current||{};
      const htemps = data.hourly?.temperature_2m||[];
      const hcode  = data.hourly?.weather_code||[];
      const nowH = new Date().getHours();
      const chips = [];
      for (let k=1;k<=5;k++){
        const idx = nowH + k;
        const t = htemps[idx]; const code = hcode[idx];
        if (t===undefined) break;
        chips.push({label: (nowH+k).toString().padStart(2,'0')+":00", temp: Math.round(t), code});
      }
      const minT = Math.round(Math.min(...htemps));
      const maxT = Math.round(Math.max(...htemps));
      const card = document.createElement('div'); card.className="card";
      card.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="text-lg font-semibold">${city.name}</div>
          <div class="sub">${Math.round(c.wind_speed_10m||0)} mph wind</div>
        </div>
        <div class="k mt-1 flex items-center gap-2">
          <span>${Math.round(c.temperature_2m||0)}°F / ${Math.round(((c.temperature_2m-32)*5/9)||0)}°C</span>
          <span aria-hidden="true">${codeToIcon(c.weather_code||0)}</span>
        </div>
        <div class="sub">Feels ${Math.round(c.apparent_temperature||0)}°F · Today ${minT}°F — ${maxT}°F</div>
        <div class="flex gap-2 mt-3 flex-wrap">
          ${chips.map(h=>`<div class="hourchip">
             <div class="sub">${h.label}</div>
             ${codeToIcon(h.code)}
             <div class="font-semibold">${h.temp}°F</div>
           </div>`).join('')}
        </div>`;
      host.appendChild(card);
    }catch(e){
      const err = document.createElement('div'); err.className="sub";
      err.textContent = `Could not load ${city.name}`; host.appendChild(err);
    }
  }
  try{
    const s = await getSun(CITIES[0].lat, CITIES[0].lon);
    $('sun-date').textContent = new Date().toLocaleDateString();
    $('sun-times').textContent = `Sunrise ${new Date(s.results.sunrise).toLocaleTimeString()} · Sunset ${new Date(s.results.sunset).toLocaleTimeString()}`;
  }catch(e){ $('sun-times').textContent = 'Could not load.'; }
}
renderWeather();
$('wx-refresh').addEventListener('click', renderWeather);

/* ---------- Verse ---------- */
async function loadVerse(){
  const st = $('v-status');
  try{
    st.textContent='Loading…';
    const txt = await getText('https://labs.bible.org/api/?passage=votd&formatting=plain');
    const i = txt.lastIndexOf('—');
    $('v-text').textContent = i>0 ? txt.slice(0,i).trim() : txt.trim();
    $('v-ref').textContent  = i>0 ? txt.slice(i+1).trim() : 'NET Bible — Verse of the Day';
    $('v-date').textContent = new Date().toLocaleDateString();
    st.textContent=' ';
  }catch(e){ st.textContent='Could not load.';}
}
loadVerse();
$('v-refresh').addEventListener('click', loadVerse);

/* ---------- Events (demo) ---------- */
const demoEvents = [
  {title:"2010 DTE Energy Music Theatre Royal Deposit", when:"2024-12-31T05:00:00Z", where:"", url:"#"},
  {title:"Megaplex Deposit", when:"2024-12-31T08:00:00Z", where:"Salt Lake Cty UT", url:"#"},
  {title:"2025 Baseball Season Ticket Deposit", when:"2024-12-31T23:30:00Z", where:"Gainesville FL", url:"#"},
  {title:"Sudbury Wolves vs. Sault Ste. Marie Greyhounds", when:"2025-10-29T14:30:00Z", where:"Sudbury ON", url:"#"},
  {title:"Ottawa 67's vs. Brampton Steelheads", when:"2025-10-29T14:30:00Z", where:"Ottawa ON", url:"#"}
];
function renderEvents(){
  const host = $('events-list'); host.innerHTML="";
  demoEvents.forEach(ev=>{
    const row = document.createElement('div'); row.className="tile tile-sm";
    row.innerHTML = `
      <div>
        <div class="font-semibold">${ev.title}</div>
        <div class="sub">${ev.when}</div>
      </div>
      <div class="text-right">
        <div class="sub">${ev.where||""}</div>
        <a href="${ev.url}" class="btn">Details</a>
      </div>`;
    host.appendChild(row);
  });
}
renderEvents();

/* ---------- Traffic (embeds) ---------- */
function dirURL(from,to){ return `https://www.google.com/maps?saddr=${encodeURIComponent(from)}&daddr=${encodeURIComponent(to)}&output=embed`; }
$('map-work').src = dirURL(HOME_ADDR, WORK_ADDR);
$('map-home').src = dirURL(WORK_ADDR, HOME_ADDR);

/* ---------- Stocks (Stooq primary, Yahoo fallback) ---------- */
function stooqSymbol(t){ return `${t.toLowerCase()}.us`; }
async function fetchStooqOne(t){
  const csv = await getText(`https://stooq.com/q/l/?s=${encodeURIComponent(stooqSymbol(t))}&f=sd2t2ohlcvn&h&e=csv`);
  const lines = csv.trim().split('\n');
  if(lines.length<2) return null;
  const c = lines[1].split(',');
  const open = parseFloat(c[3]); const close = parseFloat(c[6]);
  if (!isFinite(close)) return null;
  const pct = (isFinite(open)&&open>0) ? ((close-open)/open*100) : null;
  return {t:t.toUpperCase(), price: close, pct};
}
async function fetchYahooBatch(tickers){
  const j = await getJSON(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(tickers.join(','))}`);
  const out = {};
  (j?.quoteResponse?.result||[]).forEach(q=>{
    const t = q.symbol?.toUpperCase(); if(!t) return;
    out[t] = { t, price: q.regularMarketPrice, pct: q.regularMarketChangePercent };
  });
  return out;
}
let stockTimer = null;
async function renderStocks(){
  const grid = $('s-grid'); grid.innerHTML="";
  const status = $('s-status'); status.textContent='Loading…';
  try{
    const entries = await Promise.all(STOCKS.map(async t=>{
      try { return await fetchStooqOne(t); } catch { return null; }
    }));
    const missing = [];
    entries.forEach((d,i)=>{ if(!d) missing.push(STOCKS[i]); });

    if (missing.length){
      try{
        const ymap = await fetchYahooBatch(missing);
        missing.forEach(t=>{
          const y = ymap[t.toUpperCase()];
          const idx = STOCKS.indexOf(t);
          if (y && isFinite(y.price)) entries[idx] = {t:y.t, price:y.price, pct:y.pct};
        });
      }catch(_e){}
    }

    let ok=0;
    entries.forEach((d, i)=>{
      const div = document.createElement('div'); div.className="tile tile-sm";
      const label = STOCKS[i].toUpperCase();
      if (!d){
        div.innerHTML = `<div class="font-semibold">${label}</div><div class="sub">N/A</div>`;
        grid.appendChild(div); return;
      }
      ok++;
      const price = isFinite(d.price) ? d.price.toLocaleString(undefined,{style:'currency',currency:'USD'}) : '—';
      const pct = (d.pct==null) ? '—' : ((d.pct>=0?'+':'')+Number(d.pct).toFixed(2)+'%');
      const cls = (d.pct==null) ? '' : (d.pct>=0?'good':'bad');
      div.innerHTML = `
        <div>
          <div class="font-semibold">${label} <span class="sub">${label}</span></div>
          <div class="text-xl font-bold">${price}</div>
        </div>
        <div class="font-semibold ${cls}">${pct}</div>`;
      grid.appendChild(div);
    });
    status.textContent = ok ? 'Live (Stooq + Yahoo fallback, proxied)' : 'No data returned.';
  }catch(e){ status.textContent = 'Could not load stocks.'; }
}
renderStocks();
$('s-refresh').addEventListener('click', renderStocks);
$('s-auto').addEventListener('click', ()=>{
  if (stockTimer){ clearInterval(stockTimer); stockTimer=null; alert('Auto refresh OFF'); }
  else { stockTimer = setInterval(renderStocks, 60*1000); alert('Auto refresh ON (60s)'); }
});

/* ---------- Crypto (CoinGecko) ---------- */
async function renderCrypto(){
  const grid = $('c-grid'); grid.innerHTML="";
  const status = $('c-status');
  try{
    const j = await getJSON(`https://api.coingecko.com/api/v3/simple/price?ids=${COINS.map(c=>c.id).join(',')}&vs_currencies=usd&include_24hr_change=true`);
    for (const c of COINS){
      const d = j[c.id]; if(!d) continue;
      const price = (d.usd??0).toLocaleString(undefined,{style:'currency',currency:'USD'});
      const pct = d.usd_24h_change??0; const cls = pct>=0?'good':'bad';
      const div = document.createElement('div'); div.className="tile tile-sm";
      div.innerHTML = `<div class="font-semibold">${c.symbol}</div><div class="text-xl font-bold">${price}</div><div class="font-semibold ${cls}">${(pct>=0?'+':'')+pct.toFixed(2)}%</div>`;
      grid.appendChild(div);
    }
    status.textContent = 'Live via CoinGecko';
  }catch(e){ status.textContent='Could not load crypto.'; }
}
renderCrypto();
$('c-refresh').addEventListener('click', renderCrypto);

/* ---------- Pelosi trades ---------- */
async function renderPelosi(){
  const st = $('p-status');
  const tb = document.querySelector('#p-table tbody'); tb.innerHTML="";
  try{
    st.textContent='Loading…';
    const all = await getJSON('https://house-stock-watcher-data.s3-us-west-2.amazonaws.com/data/all_transactions.json');
    const rows = (all||[]).filter(x=>x.representative?.includes('Nancy Pelosi'))
                    .sort((a,b)=> new Date(b.disclosure_date)-new Date(a.disclosure_date))
                    .slice(0,50);
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.disclosure_date||''}</td><td>${r.transaction_date||''}</td><td>${r.ticker||r.asset_description||''}</td><td>${r.type||''}</td><td>${r.amount||''}</td><td>${r.ptr_link?`<a class="underline" target="_blank" href="${r.ptr_link}">PTR</a>`:''}</td>`;
      tb.appendChild(tr);
    });
    st.textContent = rows.length ? 'Loaded.' : 'No trades found.';
  }catch(e){ st.textContent='Could not load (network).'; }
}
renderPelosi();

/* ---------- Converters ---------- */
document.querySelectorAll('[data-x]').forEach((btn) => {
  btn.addEventListener('click', () => {
    const a = btn.dataset.x;
    const mgVal = parseFloat(($('mg')?.value ?? '0')) || 0;
    const inVal = parseFloat(($('inch')?.value ?? '0')) || 0;
    const cmVal = parseFloat(($('cm')?.value ?? '0')) || 0;
    const fVal  = parseFloat(($('f')?.value ?? '0')) || 0;
    const cVal  = parseFloat(($('c')?.value ?? '0')) || 0;

    if (a === 'mg2g')  { $('mass-out').textContent = `${mgVal} mg = ${(mgVal/1000).toFixed(6)} g`; }
    if (a === 'mg2kg') { $('mass-out').textContent = `${mgVal} mg = ${(mgVal/1e6).toFixed(9)} kg`; }
    if (a === 'in2cm') { $('len-out').textContent  = `${inVal} in = ${(inVal*2.54).toFixed(4)} cm`; }
    if (a === 'cm2in') { $('len-out').textContent  = `${cmVal} cm = ${(cmVal/2.54).toFixed(4)} in`; }
    if (a === 'f2c')   { $('temp-out').textContent = `${fVal} °F = ${((fVal-32)*5/9).toFixed(2)} °C`; }
    if (a === 'c2f')   { $('temp-out').textContent = `${cVal} °C = ${(cVal*9/5+32).toFixed(2)} °F`; }
  });
});

/* ---------- Scratchpad ---------- */
const pad = $('pad');
pad.value = localStorage.getItem('dash_pad') || "";
pad.addEventListener('input',()=> localStorage.setItem('dash_pad', pad.value));
$('pad-clear').addEventListener('click',()=>{ pad.value=""; localStorage.removeItem('dash_pad'); });
</script>
</body>
</html>
<!doctype html>
<html lang="en" id="top">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jmod Co. — Dashboard</title>
<meta name="color-scheme" content="dark light" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root {
    --card: rgba(18,18,22,.60);
    --stroke: rgba(255,255,255,.08);
    --ring: rgba(120,119,198,.25);
  }
  html { scroll-behavior:smooth; }
  body {
    background:
      radial-gradient(1200px 800px at 10% -10%, rgba(34,35,60,.25), transparent 40%),
      radial-gradient(900px 600px at 90% 10%, rgba(232,121,249,.08), transparent 55%),
      linear-gradient(180deg, #0b0b0f, #0f1015 25%, #101117 60%, #0e0f14 100%);
    color: #eef0f6;
  }
  .wrap    { max-width: 1100px; }
  .card    { background: var(--card); border:1px solid var(--stroke); border-radius:20px; padding:16px; }
  .pill    { border:1px solid var(--stroke); border-radius:999px; padding:6px 10px; font-size:.8rem; }
  .tile    { border:1px solid var(--stroke); border-radius:14px; padding:12px; }
  .tile-sm { display:flex; align-items:center; justify-content:space-between; min-height:70px; }
  .k       { font-weight:700; font-size:1.9rem; letter-spacing:.2px; }
  .sub     { opacity:.75; font-size:.85rem; }
  .btn     { border:1px solid var(--stroke); padding:6px 10px; border-radius:12px; font-size:.8rem; }
  .hourchip { border:1px solid var(--stroke); border-radius:12px; padding:10px; width:78px; text-align:center; }
  .hourchip .ico { display:block; margin:6px auto 2px; }
  .good { color:#16a34a; } .bad { color:#ef4444; }
  .table { width:100%; border-collapse: collapse; }
  .table th,.table td { border-top:1px solid var(--stroke); padding:8px; font-size:.9rem; }
  .hdr { background: rgba(10,10,14,.75); border-bottom:1px solid var(--stroke); backdrop-filter: blur(8px); }
  .btn:focus-visible, a:focus-visible, input:focus-visible, textarea:focus-visible { outline: 2px solid var(--ring); outline-offset: 2px; }

  /* YouVersion-style verse panel */
  .verse-panel {
    position: relative;
    border-radius: 18px;
    padding: 18px;
    background:
      linear-gradient(180deg, rgba(34,36,52,.95), rgba(16,18,28,.95));
    border: 1px solid rgba(255,255,255,.08);
    box-shadow:
      0 0 0 1px rgba(0,0,0,.35) inset,
      0 10px 30px rgba(120,119,198,.15),
      0 20px 60px rgba(232,121,249,.10);
  }
  .verse-panel::before{
    content:"";
    position:absolute; inset:-1px;
    border-radius:20px;
    pointer-events:none;
    background: linear-gradient(135deg, rgba(232,121,249,.35), rgba(56,189,248,.35));
    mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    padding:1px; border-radius:20px;
    opacity:.35;
  }
  .verse-quote{
    font-size:1.25rem; line-height:1.9rem;
  }
  .verse-accent{
    color:#93c5fd; /* soft blue for labels */
  }

  @media (max-width: 640px){ .k { font-size: 1.6rem; } .verse-quote{ font-size:1.1rem; line-height:1.7rem; } }
</style>
</head>
<body>

<!-- NAV -->
<header class="hdr sticky top-0 z-50">
  <nav class="wrap mx-auto flex items-center justify-between px-3 py-2">
    <a href="#top" class="font-semibold">Jmod Co. — Dashboard</a>
    <ul class="flex items-center gap-3 text-sm">
      <li><a class="pill" href="/index.html">Resume</a></li>
      <li><a class="pill" href="#events">Local Events</a></li>
      <li><a class="pill" href="#traffic">Traffic</a></li>
      <li><a class="pill" href="#stocks">Stocks</a></li>
      <li><a class="pill" href="#conversions">Conversions</a></li>
    </ul>
  </nav>
</header>

<main class="wrap mx-auto px-3 py-5 space-y-6">

  <!-- Welcome -->
  <section class="card">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold">Welcome</h1>
        <p class="sub mt-1">Tinkering, learning, shipping. Explore anything on display.</p>
      </div>
      <div class="flex gap-2">
        <span id="today-pill" class="pill"></span>
        <span class="pill hidden sm:inline">Live</span>
      </div>
    </div>
  </section>

  <!-- Weather -->
  <section id="weather" class="card space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Weather</h2>
      <button id="wx-refresh" class="btn">Refresh</button>
    </div>
    <div id="wx-cards" class="grid gap-4 md:grid-cols-2"></div>

    <div class="card">
      <div class="flex items-center justify-between">
        <div class="text-lg font-semibold">Sunrise • Sunset</div>
        <span id="sun-date" class="pill"></span>
      </div>
      <div id="sun-times" class="sub mt-2">Loading…</div>
    </div>
  </section>

  <!-- Verse + Events side-by-side -->
  <section class="grid gap-4 md:grid-cols-2">
    <!-- Verse -->
    <section id="verse" class="card">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Verse of the Day</h2>
        <button id="v-refresh" class="btn">Refresh</button>
      </div>
      <div id="v-status" class="sub mt-1">Loading…</div>
      <div class="mt-3 verse-panel">
        <div class="flex items-center justify-between">
          <div class="pill inline-block">Verse of the Day</div>
          <div id="v-date" class="sub"></div>
        </div>
        <blockquote id="v-text" class="verse-quote mt-3"></blockquote>
        <div id="v-ref" class="verse-accent mt-2"></div>
      </div>
    </section>

    <!-- Local Events -->
    <section id="events" class="card">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Local Events</h2>
        <span class="pill">next 7–14 days</span>
      </div>
      <div id="events-list" class="mt-3 space-y-3"></div>
      <div class="sub mt-2">Demo feed now; we can swap to Ticketmaster/SeatGeek later.</div>
    </section>
  </section>

  <!-- Traffic side-by-side -->
  <section id="traffic" class="card space-y-4">
    <h2 class="text-xl font-semibold">Traffic</h2>
    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <div class="font-medium mb-2">To Work</div>
        <div class="rounded-2xl overflow-hidden border border-neutral-800 aspect-video">
          <iframe id="map-work" class="w-full h-full" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
      <div>
        <div class="font-medium mb-2">To Home</div>
        <div class="rounded-2xl overflow-hidden border border-neutral-800 aspect-video">
          <iframe id="map-home" class="w-full h-full" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Stocks compact tiles -->
  <section id="stocks" class="card">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">Stocks</h2>
      <div class="flex items-center gap-2">
        <button id="s-auto" class="btn">auto refresh</button>
        <button id="s-refresh" class="btn">Refresh</button>
      </div>
    </div>
    <div id="s-grid" class="grid gap-3 grid-cols-2 md:grid-cols-4"></div>
    <div id="s-status" class="sub mt-2"></div>
  </section>

  <!-- Crypto compact tiles -->
  <section id="crypto" class="card">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">Crypto</h2>
      <button id="c-refresh" class="btn">Refresh</button>
    </div>
    <div id="c-grid" class="grid gap-3 grid-cols-2 md:grid-cols-4"></div>
    <div id="c-status" class="sub mt-2"></div>
  </section>

  <!-- Pelosi -->
  <section id="pelosi" class="card">
    <h2 class="text-xl font-semibold mb-2">Nancy Pelosi — Disclosed Trades (latest 50)</h2>
    <div id="p-status" class="sub mb-2">Loading…</div>
    <div class="overflow-auto">
      <table class="table" id="p-table">
        <thead><tr><th>Disclosed</th><th>Traded</th><th>Ticker / Asset</th><th>Type</th><th>Amount</th><th>PTR</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Conversions -->
  <section id="conversions" class="card">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Conversions</h2>
    </div>
    <div class="grid md:grid-cols-3 gap-4 mt-3">
      <div class="card">
        <div class="font-medium mb-2">Mass (mg ↔ g ↔ kg)</div>
        <input id="mg" type="number" step="any" placeholder="mg" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="mg2g">To g</button>
          <button class="btn" data-x="mg2kg">To kg</button>
        </div>
        <div id="mass-out" class="sub mt-2"></div>
      </div>
      <div class="card">
        <div class="font-medium mb-2">Length (in ↔ cm)</div>
        <input id="inch" type="number" step="any" placeholder="inches" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <input id="cm" type="number" step="any" placeholder="centimeters" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2 mt-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="in2cm">To cm</button>
          <button class="btn" data-x="cm2in">cm → in</button>
        </div>
        <div id="len-out" class="sub mt-2"></div>
      </div>
      <div class="card">
        <div class="font-medium mb-2">Temperature (°F ↔ °C)</div>
        <input id="f" type="number" step="any" placeholder="°F" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2">
        <input id="c" type="number" step="any" placeholder="°C" class="w-full bg-transparent border border-neutral-800 rounded-xl p-2 mt-2">
        <div class="flex gap-2 mt-2">
          <button class="btn" data-x="f2c">To °C</button>
          <button class="btn" data-x="c2f">°C → °F</button>
        </div>
        <div id="temp-out" class="sub mt-2"></div>
      </div>
    </div>
  </section>

  <!-- Scratchpad -->
  <section id="scratchpad" class="card">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Scratchpad</h2>
      <button id="pad-clear" class="btn">Clear</button>
    </div>
    <textarea id="pad" class="w-full h-40 bg-neutral-900 border border-neutral-800 rounded-2xl p-3 mt-2" placeholder="Jot quick notes…"></textarea>
  </section>

  <!-- Footer -->
  <footer class="py-8 text-center sub">
    ✦ Crafted by Jordan Moddes · Built with GPT-5 Thinking ✦
  </footer>
</main>

<script>
/* ====== CONFIG (edit) ====== */
const HOME_ADDR = "411 W Main St, Round Rock, TX";
const WORK_ADDR = "2670 S A.W. Grimes Blvd, Round Rock, TX";
const CITIES = [
  { name:"Round Rock, TX", lat:30.5083, lon:-97.6789 },
  { name:"Pleasant Prairie, WI", lat:42.5531, lon:-87.9334 },
  { name:"Grayslake, IL", lat:42.3445, lon:-88.0417 },
  { name:"Cleveland, OH", lat:41.4993, lon:-81.6944 },
];
const STOCKS = ["BRK.A","BRK.B","AAPL","NVDA","AXP","DAL","HHH","ABNB","SNAP","MOS","RIVN","KO","FWONK","TSLA","AMZN","GNW"];
const COINS = [
  { id:"bitcoin", symbol:"BTC" },
  { id:"ethereum", symbol:"ETH" },
  { id:"solana", symbol:"SOL" },
  { id:"dogecoin", symbol:"DOGE" }
];
/* =========================== */

const $ = (id) => document.getElementById(id);

/* Small proxy helper: tries direct URL, then r.jina.ai (CORS-safe text), then JSON parse if requested */
async function getText(url){
  try {
    const r = await fetch(url, {mode:'cors'}); if (!r.ok) throw new Error(r.status);
    return await r.text();
  } catch {
    const proxy = `https://r.jina.ai/${url.startsWith('https')?'https':'http'}://${url.replace(/^https?:\/\//,'')}`;
    const r2 = await fetch(proxy, {mode:'cors'}); if (!r2.ok) throw new Error(r2.status);
    return await r2.text();
  }
}
async function getJSON(url){
  const t = await getText(url);
  try { return JSON.parse(t); } catch { return null; }
}

/* meta */
$('today-pill').textContent = new Date().toLocaleDateString();

/* ---------- Weather ---------- */
function codeToIcon(code){
  const sun = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" fill="#fde047"/><g stroke="#fde047" stroke-width="2"><path d="M12 1v3"/><path d="M12 20v3"/><path d="M1 12h3"/><path d="M20 12h3"/><path d="M4.2 4.2l2.2 2.2"/><path d="M17.6 17.6l2.2 2.2"/><path d="M4.2 19.8l2.2-2.2"/><path d="M17.6 6.4l2.2-2.2"/></g></svg>';
  const cloud = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 18h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/></svg>';
  const rain = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 16h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><g stroke="#60a5fa" stroke-width="2"><path d="M9 18v3"/><path d="M12 18v3"/><path d="M15 18v3"/></g></svg>';
  const snow = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 16h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><g stroke="#e5e7eb" stroke-width="2"><path d="M9 18l-1 3"/><path d="M12 18l-1 3"/><path d="M15 18l-1 3"/></g></svg>';
  const storm = '<svg class="ico" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 15h9a4 4 0 0 0 0-8 6 6 0 0 0-11.5 2" fill="#94a3b8"/><path d="M12 14l-3 6 5-4h-3l3-4" fill="#f59e0b"/></svg>';
  if ([0,1].includes(code)) return sun;
  if ([2,3,45,48].includes(code)) return cloud;
  if ([61,63,65,51,53,55].includes(code)) return rain;
  if ([71,73,75].includes(code)) return snow;
  if ([95].includes(code)) return storm;
  return cloud;
}
async function getWeather(lat, lon){
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&temperature_unit=fahrenheit&windspeed_unit=mph&forecast_days=1&timezone=auto`;
  const j = await getJSON(url); if(!j) throw new Error('weather');
  return j;
}
async function getSun(lat, lon){
  const url = `https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`;
  const j = await getJSON(url); if(!j) throw new Error('sun');
  return j;
}
async function renderWeather(){
  const host = $('wx-cards'); host.innerHTML="";
  for (const city of CITIES){
    try{
      const data = await getWeather(city.lat, city.lon);
      const c = data.current||{};
      const htemps = data.hourly?.temperature_2m||[];
      const hcode  = data.hourly?.weather_code||[];
      const nowH = new Date().getHours();
      const chips = [];
      for (let k=1;k<=5;k++){
        const idx = nowH + k;
        const t = htemps[idx]; const code = hcode[idx];
        if (t===undefined) break;
        chips.push({label: (nowH+k).toString().padStart(2,'0')+":00", temp: Math.round(t), code});
      }
      const minT = Math.round(Math.min(...htemps));
      const maxT = Math.round(Math.max(...htemps));
      const card = document.createElement('div'); card.className="card";
      card.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="text-lg font-semibold">${city.name}</div>
          <div class="sub">${Math.round(c.wind_speed_10m||0)} mph wind</div>
        </div>
        <div class="k mt-1 flex items-center gap-2">
          <span>${Math.round(c.temperature_2m||0)}°F / ${Math.round(((c.temperature_2m-32)*5/9)||0)}°C</span>
          <span aria-hidden="true">${codeToIcon(c.weather_code||0)}</span>
        </div>
        <div class="sub">Feels ${Math.round(c.apparent_temperature||0)}°F · Today ${minT}°F — ${maxT}°F</div>
        <div class="flex gap-2 mt-3 flex-wrap">
          ${chips.map(h=>`<div class="hourchip">
             <div class="sub">${h.label}</div>
             ${codeToIcon(h.code)}
             <div class="font-semibold">${h.temp}°F</div>
           </div>`).join('')}
        </div>`;
      host.appendChild(card);
    }catch(e){
      const err = document.createElement('div'); err.className="sub";
      err.textContent = `Could not load ${city.name}`;
      host.appendChild(err);
    }
  }
  try{
    const s = await getSun(CITIES[0].lat, CITIES[0].lon);
    $('sun-date').textContent = new Date().toLocaleDateString();
    $('sun-times').textContent = `Sunrise ${new Date(s.results.sunrise).toLocaleTimeString()} · Sunset ${new Date(s.results.sunset).toLocaleTimeString()}`;
  }catch(e){ $('sun-times').textContent = 'Could not load.'; }
}
renderWeather();
$('wx-refresh').addEventListener('click', renderWeather);

/* ---------- Verse ---------- */
async function loadVerse(){
  const st = $('v-status');
  try{
    st.textContent='Loading…';
    const txt = await getText('https://labs.bible.org/api/?passage=votd&formatting=plain');
    const i = txt.lastIndexOf('—');
    $('v-text').textContent = i>0 ? txt.slice(0,i).trim() : txt.trim();
    $('v-ref').textContent  = i>0 ? txt.slice(i+1).trim() : 'NET Bible — Verse of the Day';
    $('v-date').textContent = new Date().toLocaleDateString();
    st.textContent=' ';
  }catch(e){ st.textContent='Could not load.';}
}
loadVerse();
$('v-refresh').addEventListener('click', loadVerse);

/* ---------- Events (demo) ---------- */
const demoEvents = [
  {title:"2010 DTE Energy Music Theatre Royal Deposit", when:"2024-12-31T05:00:00Z", where:"", url:"#"},
  {title:"Megaplex Deposit", when:"2024-12-31T08:00:00Z", where:"Salt Lake Cty UT", url:"#"},
  {title:"2025 Baseball Season Ticket Deposit", when:"2024-12-31T23:30:00Z", where:"Gainesville FL", url:"#"},
  {title:"Sudbury Wolves vs. Sault Ste. Marie Greyhounds", when:"2025-10-29T14:30:00Z", where:"Sudbury ON", url:"#"},
  {title:"Ottawa 67's vs. Brampton Steelheads", when:"2025-10-29T14:30:00Z", where:"Ottawa ON", url:"#"}
];
function renderEvents(){
  const host = $('events-list'); host.innerHTML="";
  demoEvents.forEach(ev=>{
    const row = document.createElement('div'); row.className="tile tile-sm";
    row.innerHTML = `
      <div>
        <div class="font-semibold">${ev.title}</div>
        <div class="sub">${ev.when}</div>
      </div>
      <div class="text-right">
        <div class="sub">${ev.where||""}</div>
        <a href="${ev.url}" class="btn">Details</a>
      </div>`;
    host.appendChild(row);
  });
}
renderEvents();

/* ---------- Traffic (embeds) ---------- */
function dirURL(from,to){ return `https://www.google.com/maps?saddr=${encodeURIComponent(from)}&daddr=${encodeURIComponent(to)}&output=embed`; }
$('map-work').src = dirURL(HOME_ADDR, WORK_ADDR);
$('map-home').src = dirURL(WORK_ADDR, HOME_ADDR);

/* ---------- Stocks (Stooq primary, Yahoo fallback) ---------- */
function stooqSymbol(t){ return `${t.toLowerCase()}.us`; }
async function fetchStooqOne(t){
  const csv = await getText(`https://stooq.com/q/l/?s=${encodeURIComponent(stooqSymbol(t))}&f=sd2t2ohlcvn&h&e=csv`);
  const lines = csv.trim().split('\n');
  if(lines.length<2) return null;
  const c = lines[1].split(',');
  const open = parseFloat(c[3]); const close = parseFloat(c[6]);
  if (!isFinite(close)) return null;
  const pct = (isFinite(open)&&open>0) ? ((close-open)/open*100) : null;
  return {t:t.toUpperCase(), price: close, pct};
}
async function fetchYahooBatch(tickers){
  const j = await getJSON(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(tickers.join(','))}`);
  const out = {};
  (j?.quoteResponse?.result||[]).forEach(q=>{
    const t = q.symbol?.toUpperCase(); if(!t) return;
    out[t] = { t, price: q.regularMarketPrice, pct: q.regularMarketChangePercent };
  });
  return out;
}
let stockTimer = null;
async function renderStocks(){
  const grid = $('s-grid'); grid.innerHTML="";
  const status = $('s-status'); status.textContent='Loading…';
  try{
    const entries = await Promise.all(STOCKS.map(async t=>{
      try { return await fetchStooqOne(t); } catch { return null; }
    }));
    const missing = [];
    entries.forEach((d,i)=>{ if(!d) missing.push(STOCKS[i]); });

    if (missing.length){
      try{
        const ymap = await fetchYahooBatch(missing);
        missing.forEach(t=>{
          const y = ymap[t.toUpperCase()];
          const idx = STOCKS.indexOf(t);
          if (y && isFinite(y.price)) entries[idx] = {t:y.t, price:y.price, pct:y.pct};
        });
      }catch(_e){}
    }

    let ok=0;
    entries.forEach((d, i)=>{
      const div = document.createElement('div'); div.className="tile tile-sm";
      const label = STOCKS[i].toUpperCase();
      if (!d){
        div.innerHTML = `<div class="font-semibold">${label}</div><div class="sub">N/A</div>`;
        grid.appendChild(div); return;
      }
      ok++;
      const price = isFinite(d.price) ? d.price.toLocaleString(undefined,{style:'currency',currency:'USD'}) : '—';
      const pct = (d.pct==null) ? '—' : ((d.pct>=0?'+':'')+Number(d.pct).toFixed(2)+'%');
      const cls = (d.pct==null) ? '' : (d.pct>=0?'good':'bad');
      div.innerHTML = `
        <div>
          <div class="font-semibold">${label} <span class="sub">${label}</span></div>
          <div class="text-xl font-bold">${price}</div>
        </div>
        <div class="font-semibold ${cls}">${pct}</div>`;
      grid.appendChild(div);
    });
    status.textContent = ok ? 'Live (Stooq + Yahoo fallback, proxied)' : 'No data returned.';
  }catch(e){ status.textContent = 'Could not load stocks.'; }
}
renderStocks();
$('s-refresh').addEventListener('click', renderStocks);
$('s-auto').addEventListener('click', ()=>{
  if (stockTimer){ clearInterval(stockTimer); stockTimer=null; alert('Auto refresh OFF'); }
  else { stockTimer = setInterval(renderStocks, 60*1000); alert('Auto refresh ON (60s)'); }
});

/* ---------- Crypto (CoinGecko) ---------- */
async function renderCrypto(){
  const grid = $('c-grid'); grid.innerHTML="";
  const status = $('c-status');
  try{
    const j = await getJSON(`https://api.coingecko.com/api/v3/simple/price?ids=${COINS.map(c=>c.id).join(',')}&vs_currencies=usd&include_24hr_change=true`);
    for (const c of COINS){
      const d = j[c.id]; if(!d) continue;
      const price = (d.usd??0).toLocaleString(undefined,{style:'currency',currency:'USD'});
      const pct = d.usd_24h_change??0; const cls = pct>=0?'good':'bad';
      const div = document.createElement('div'); div.className="tile tile-sm";
      div.innerHTML = `<div class="font-semibold">${c.symbol}</div><div class="text-xl font-bold">${price}</div><div class="font-semibold ${cls}">${(pct>=0?'+':'')+pct.toFixed(2)}%</div>`;
      grid.appendChild(div);
    }
    status.textContent = 'Live via CoinGecko';
  }catch(e){ status.textContent='Could not load crypto.'; }
}
renderCrypto();
$('c-refresh').addEventListener('click', renderCrypto);

/* ---------- Pelosi trades (proxied to avoid CORS) ---------- */
async function renderPelosi(){
  const st = $('p-status');
  const tb = document.querySelector('#p-table tbody'); tb.innerHTML="";
  try{
    st.textContent='Loading…';
    const all = await getJSON('https://house-stock-watcher-data.s3-us-west-2.amazonaws.com/data/all_transactions.json');
    const rows = (all||[]).filter(x=>x.representative?.includes('Nancy Pelosi'))
                    .sort((a,b)=> new Date(b.disclosure_date)-new Date(a.disclosure_date))
                    .slice(0,50);
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.disclosure_date||''}</td><td>${r.transaction_date||''}</td><td>${r.ticker||r.asset_description||''}</td><td>${r.type||''}</td><td>${r.amount||''}</td><td>${r.ptr_link?`<a class="underline" target="_blank" href="${r.ptr_link}">PTR</a>`:''}</td>`;
      tb.appendChild(tr);
    });
    st.textContent = rows.length ? 'Loaded.' : 'No trades found.';
  }catch(e){
    st.textContent='Could not load (network).';
  }
}
renderPelosi();

/* ---------- Converters ---------- */
document.querySelectorAll('[data-x]').forEach((btn) => {
  btn.addEventListener('click', () => {
    const a = btn.dataset.x;
    const mgVal = parseFloat(($('mg')?.value ?? '0')) || 0;
    const inVal = parseFloat(($('inch')?.value ?? '0')) || 0;
    const cmVal = parseFloat(($('cm')?.value ?? '0')) || 0;
    const fVal  = parseFloat(($('f')?.value ?? '0')) || 0;
    const cVal  = parseFloat(($('c')?.value ?? '0')) || 0;

    if (a === 'mg2g')  { $('mass-out').textContent = `${mgVal} mg = ${(mgVal/1000).toFixed(6)} g`; }
    if (a === 'mg2kg') { $('mass-out').textContent = `${mgVal} mg = ${(mgVal/1e6).toFixed(9)} kg`; }
    if (a === 'in2cm') { $('len-out').textContent  = `${inVal} in = ${(inVal*2.54).toFixed(4)} cm`; }
    if (a === 'cm2in') { $('len-out').textContent  = `${cmVal} cm = ${(cmVal/2.54).toFixed(4)} in`; }
    if (a === 'f2c')   { $('temp-out').textContent = `${fVal} °F = ${((fVal-32)*5/9).toFixed(2)} °C`; }
    if (a === 'c2f')   { $('temp-out').textContent = `${cVal} °C = ${(cVal*9/5+32).toFixed(2)} °F`; }
  });
});

/* ---------- Scratchpad ---------- */
const pad = $('pad');
pad.value = localStorage.getItem('dash_pad') || "";
pad.addEventListener('input',()=> localStorage.setItem('dash_pad', pad.value));
$('pad-clear').addEventListener('click',()=>{ pad.value=""; localStorage.removeItem('dash_pad'); });
</script>
</body>
</html>